(this["webpackJsonpchatty2.0"]=this["webpackJsonpchatty2.0"]||[]).push([[0],{159:function(e,t,n){},175:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(49),i=n.n(c),s=n(14),o=n.n(s),l=n(19),d=n(10),u=(n(159),n(130));function b(e){"dark"!==e&&"light"!==e&&(e="dark");var t={shape:{borderRadius:7},palette:{mode:e,primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}},typography:{fontFamily:["Poppins","Roboto","-apple-system","BlinkMacSystemFont","system-ui",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")},components:{MuiCssBaseline:{styleOverrides:"dark"===e?"/* ====== Custom scrollbar ======= */\n::-webkit-scrollbar {\n    background-color: #fff;\n    width: 14px\n}\n\n/* Background of the scrollbar except button or resizer */\n::-webkit-scrollbar-track {\n    background-color: #2c2c2c;\n}\n\n::-webkit-scrollbar-corner {\n    background-color: #2c2c2c;\n}\n\nbody.light ::-webkit-scrollbar-track, body.light ::-webkit-scrollbar-corner {\n    background-color: rgb(223, 223, 223);\n}\n\n/* scrollbar itself */\n::-webkit-scrollbar-thumb {\n    background-color: rgb(107, 107, 107);\n    border-radius: 14px;\n    border: 3px solid #2c2c2c;\n    transition: all 500ms ease-out;\n}\n::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(149, 149, 149);\n}\n\n.light *::-webkit-scrollbar-thumb {\n    background-color: rgb(150, 150, 150) !important;\n    border: 3px solid rgb(223, 223, 223) !important;\n}\n.light *::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(101, 101, 101) !important;\n}\n/* ============ */":""}}},n=Object(u.a)(t);return n.shape.borderRadius=7,n}var j=n(59),h=n(42),x=n(45),p=n.n(x);function O(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer}function m(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return btoa(t)}var f=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),a=btoa(window.crypto.getRandomValues(new Uint8Array(12))),e.next=4,window.crypto.subtle.encrypt({name:"AES-GCM",iv:(new TextEncoder).encode(a)},n,r);case 4:return c=e.sent,i=new Uint8Array(c),s=m(i),e.abrupt("return",{data:s,iv:a});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.data,a=(new TextEncoder).encode(t.iv),c=O(r),i={name:"AES-GCM",iv:a},console.log("here"),e.next=8,window.crypto.subtle.decrypt(i,n,c);case 8:return s=e.sent,console.log("ok"),e.abrupt("return",(new TextDecoder).decode(s));case 13:return e.prev=13,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),v=n(27),y=function(){function e(){Object(j.a)(this,e),this.contents={}}return Object(h.a)(e,[{key:"isInit",value:function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("iv");case 2:if(e.t1=e.sent,!e.t1){e.next=7;break}return e.next=6,p.a.getItem("salt");case 6:e.t1=e.sent;case 7:if(e.t0=e.t1,!e.t0){e.next=12;break}return e.next=11,p.a.getItem("data");case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"genKey",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("salt");case 2:return n=e.sent,e.next=5,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 5:return r=e.sent,console.log(r),e.next=9,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:O(n),iterations:1e5,hash:"SHA-512"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);case 9:this.key=e.sent;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unlock",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("iv");case 2:return n=e.sent,e.next=5,this.genKey(t);case 5:return e.next=7,p.a.getItem("data");case 7:return r=e.sent,e.next=10,g({data:v.decompress(r),iv:v.decompress(n)},this.key);case 10:if(a=e.sent){e.next=13;break}return e.abrupt("return",!1);case 13:return this.contents=JSON.parse(v.decompressFromUTF16(a)),console.log(this.contents),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sync",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(v.compressToUTF16(JSON.stringify(this.contents)),this.key);case 2:return t=e.sent,e.next=5,p.a.setItem("data",v.compress(t.data));case 5:return e.next=7,p.a.setItem("iv",v.compress(t.iv));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,window.crypto.getRandomValues(new Uint8Array(128));case 3:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.next=7,p.a.setItem("salt",n);case 7:return e.next=9,this.genKey(t);case 9:return e.next=11,this.sync();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setVal",value:function(){var e=Object(l.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.contents[t]=n,e.next=3,this.sync();case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVal",value:function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contents[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=n(308),k=n(247),S=n(24),C=n(3),A=n(18),D=n(273),T=n(254),I=n(77),R=function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);var r=["#8e24aa","#5e35b1","#3949ab","#1976d2","#00838f","#00796b","#2e7d32","#827717","#bf360c","#795548","#d32f2f","#546e7a"];return r[t%r.length]},P=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];return console.log("%c".concat(e,"%c").concat(t,"%c ").concat(r.join(" ")),"color:#fff; padding: 2px 4px; background-color: ".concat(R(e),"; border-radius: 4px 0 0 4px; border: 1px solid #888"),"border: 1px solid #888; padding: 2px 4px; border-radius: 0 4px 4px 0; border-left: none","")},F=n(296),E=n(297),M=n(274),U=n(259),B=n(279),K=n(288),N=n(255),W=n(285),L=n(301),J=n(257),z=n(280),G=n(290),H=n(93),V=n(291),q=n(278),Y=n(276),X=n(132),$=n(302),_=n(277),Q=n(267),Z=n(292),ee=n(303),te=n(293),ne=n(304),re=n(294),ae=n(295),ce=n(262),ie=n(260),se=n(256),oe=n(114),le=n(69),de=n(75),ue=n(120),be=n(121),je=n(123),he=n(115),xe=n(124),pe=n.p+"static/media/icon.7a29522d.svg",Oe=n(122),me=n(68),fe=n(92),ge=n(275),ve=n(106),ye=n(105),we=n(0);function ke(e){var t;return Object(we.jsx)("div",{style:{flexGrow:1,padding:10,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:null!==(t=e.addChat)&&void 0!==t&&t?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(ye.a,{sx:{width:"30%",height:"30%"}}),Object(we.jsx)(M.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"This space looks a little empty..."}),Object(we.jsx)(M.a,{align:"center",children:"Click on the add button above to create your first chat"})]}):Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(ve.a,{sx:{width:"30%",height:"30%"}}),Object(we.jsx)(M.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"Click on a chat to begin chatting!"})]})})}var Se=Object(r.memo)(ke);function Ce(e){var t=Object.keys(e.cl).filter((function(t){return e.cl[t].name.toLowerCase().includes(e.q.trim().toLowerCase())}));return Object(we.jsx)(ge.a,{sx:{width:"100%",p:0,overflowY:"auto"},children:0!==t.length?t.map((function(t){var n,r;return Object(we.jsx)(N.a,{title:null===(n=e.cl[t])||void 0===n?void 0:n.name,placement:"right",children:Object(we.jsxs)(H.b,{button:!0,selected:e.cg===t,divider:!0,dense:e.cv&&e.ac,sx:e.cv&&e.ac?{padding:".25rem .75rem",width:"64px",height:"64px"}:{},onClick:function(){return e.sg(t)},children:[Object(we.jsx)(_.a,{children:Object(we.jsx)(Q.a,{children:Object(we.jsx)(de.a,{})})}),Object(we.jsx)(q.a,{primary:null===(r=e.cl[t])||void 0===r?void 0:r.name,secondary:"Changhoa: Hm"})]})},t)})):0===e.q.trim().length?Object(we.jsx)(Se,{addChat:!0}):Object(we.jsx)(H.b,{children:Object(we.jsx)(q.a,{primary:"No results"})})})}var Ae=Object(r.memo)(Ce),De=n(268),Te=n(269),Ie=n(281),Re=n(110),Pe=n(111),Fe=n(107),Ee=n(108),Me=n(109);function Ue(e){var t=e.disableState,n=e.send,a=Object(r.useRef)(),c=[{icon:Object(we.jsx)(Fe.a,{}),name:"Photos & Videos",onClick:function(){console.log("photos and videos"),a.current.click()}},{icon:Object(we.jsx)(Ee.a,{}),name:"Camera",onClick:function(){}},{icon:Object(we.jsx)(Me.a,{}),name:"Document",onClick:function(){}}];return Object(we.jsxs)(we.Fragment,{children:[t.disabled&&Object(we.jsxs)(B.a,{variant:"outlined",sx:{width:"calc(100% - 1rem)",mb:1,mx:1,height:"calc(56px - .5rem)",display:"flex",p:1,alignItems:"center"},children:[t.icon,Object(we.jsx)(M.a,{ml:1,children:t.label})]}),(!t.disabled||!t)&&Object(we.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",width:"100%"},children:[Object(we.jsx)("input",{type:"file",ref:a,style:{display:"none"},onChange:function(e){console.log("File picked:",e.currentTarget.files[0]);var t=e.currentTarget.files[0];if(e.currentTarget.value="",/\.(jpe?g|png|gif)$/i.test(t.name)){var r=new FileReader;r.onload=function(e){n("img",e.target.result),console.log(e.target.result)},r.readAsDataURL(t)}}}),Object(we.jsx)(De.a,{sx:{"&>button":{width:"46px",height:"46px"},position:"absolute",bottom:6,left:1},ariaLabel:"Add an attachment",icon:Object(we.jsx)(Te.a,{icon:Object(we.jsx)(Re.a,{})}),children:c.map((function(e){return Object(we.jsx)(Ie.a,{onClick:e.onClick,icon:e.icon,tooltipTitle:e.name},e.name)}))}),Object(we.jsx)(J.a,{variant:"filled",multiline:!0,label:"Say something awesome in ".concat(e.n),maxRows:5,onChange:function(t){return e.sm(t.target.value)},value:e.m,onKeyPress:function(t){"Enter"!==t.key||t.shiftKey||(e.send(),t.preventDefault())},inputProps:{maxLength:1e3},sx:{flexGrow:1,mr:.5,ml:"58px","& textarea.MuiInputBase-input":{fontFamily:'"Source Sans Pro", system-ui, sans-serif',fontSize:18}}}),Object(we.jsx)(W.a,{color:"primary","aria-label":"send",sx:{mr:.5,mb:.5},onClick:e.send,children:Object(we.jsx)(Pe.a,{})})]})]})}var Be=n(6),Ke=n(264),Ne=n(284),We=n(272),Le=n(5),Je=n(112),ze=n.n(Je),Ge=n(243),He=n(134),Ve=n(131),qe=n(286),Ye=n(287),Xe=n(271),$e=n(289),_e=n(242),Qe=function(e,t){return t?new URL(t,e).href:null},Ze=function(e){Object(He.a)(n,e);var t=Object(Ve.a)(n);function n(e){var r;return Object(j.a)(this,n),(r=t.call(this,e)).state={sData:null,imgHasLoaded:!1},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;if(localStorage[this.props.url]){var t=JSON.parse(localStorage[this.props.url]);if(t.expire>+new Date)return P("sitePrev","Cache hit at",this.props.url),void this.setState({sData:t})}Object(l.a)(o.a.mark((function t(){var n,r,a,c,i,s,l,d,u,b,j,h,x,p,O,m,f;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://cors.bridged.cc/"+e.props.url);case 2:return t.next=4,t.sent.text();case 4:u=t.sent,b=(new DOMParser).parseFromString(u,"text/html"),j=(null===(n=b.querySelector('meta[property="og:title"]'))||void 0===n?void 0:n.getAttribute("content"))||(null===(r=b.querySelector("title"))||void 0===r?void 0:r.textContent),h=(null===(a=b.querySelector('meta[property="og:site_name"]'))||void 0===a?void 0:a.getAttribute("content"))||j,x=(null===(c=b.querySelector('meta[property="og:description"]'))||void 0===c?void 0:c.getAttribute("content"))||(null===(i=b.querySelector('meta[property="description"]'))||void 0===i?void 0:i.getAttribute("content"))||(null===(s=b.querySelector('meta[name="description"]'))||void 0===s?void 0:s.getAttribute("content")),p=Qe(e.props.url,null===(l=b.querySelector('meta[property="og:image"]'))||void 0===l?void 0:l.getAttribute("content")),O=Qe(e.props.url,null===(d=b.querySelector('link[rel="icon"]'))||void 0===d?void 0:d.getAttribute("href")),(m=new Date).setDate(m.getDate()+1),f={siteName:h,title:j,description:x,favicon:O,imgURL:p},localStorage[e.props.url]=JSON.stringify(Object(A.a)(Object(A.a)({},f),{},{expire:+m})),e.setState({sData:f});case 16:case"end":return t.stop()}}),t)})))()}},{key:"shouldComponentUpdate",value:function(e,t,n){return this.state!==t}},{key:"render",value:function(){var e,t=this,n=!this.state.sData;return n||this.props.sb(),Object(we.jsx)(qe.a,{variant:"outlined",sx:{my:.8},children:Object(we.jsxs)(Ye.a,{sx:{p:1.25,pb:"10px!important",display:"flex",flexDirection:"column",alignItems:"flex-start",width:400,maxWidth:"100%"},children:[Object(we.jsxs)(K.a,{display:"flex",alignItems:"center",children:[n?Object(we.jsx)(Xe.a,{width:20,height:20,variant:"circular",animation:"wave"}):Object(we.jsx)(Q.a,{sx:{width:20,height:20},src:this.state.sData.favicon,children:Object(we.jsx)(_e.a,{sx:{width:20,height:20}})}),Object(we.jsx)(M.a,{variant:"caption",width:n?100:"auto",ml:1,children:n?Object(we.jsx)(Xe.a,{animation:"wave"}):this.state.sData.siteName})]}),Object(we.jsx)(M.a,{variant:"h6",mt:.75,width:n?"60%":"auto",children:n?Object(we.jsx)(Xe.a,{width:"300",animation:"wave"}):Object(we.jsx)($e.a,{href:this.props.url,children:null!==(e=this.state.sData.title)&&void 0!==e?e:this.props.url})}),n?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(Xe.a,{width:"100%",height:14,animation:"wave",sx:{mt:.75}}),Object(we.jsx)(Xe.a,{width:"100%",height:14,animation:"wave"}),Object(we.jsx)(Xe.a,{width:"80%",height:14,animation:"wave"})]}):Object(we.jsxs)(we.Fragment,{children:[this.state.sData.description&&Object(we.jsx)(M.a,{variant:"subtitle2",color:"text.secondary",mt:.75,children:this.state.sData.description}),this.state.sData.imgURL&&Object(we.jsx)("img",{src:this.state.sData.imgURL,alt:"",onLoad:function(){return t.setState({imgHasLoaded:!0})},onError:function(){return t.setState({imgHasLoaded:!0})},draggable:!1,style:{maxWidth:"100%",minWidth:100,maxHeight:213.75,marginTop:8,borderRadius:4}})]}),(n||this.state.sData.imgURL&&!this.state.imgHasLoaded)&&Object(we.jsx)(Xe.a,{width:"100%",height:213.75,animation:"wave",sx:{transform:"none",borderRadius:"7px",mt:1}})]})})}}]),n}(r.Component),et=Object(se.a)((function(e){return{msgBubble:{width:"fit-content",maxWidth:"80%",padding:"".concat(e.spacing(.6)," ").concat(e.spacing(1.4)),boxShadow:e.shadows[3],overflow:"hidden","&>p":{whiteSpace:"break-spaces",overflowWrap:"anywhere",marginTop:-4,fontFamily:'"Source Sans Pro", Poppins, system-ui, sans-serif',letterSpacing:".2px","& a":{color:e.palette.primary.main}},"&>span":{fontWeight:900}},holder:{width:"100%",padding:"".concat(e.spacing(.25)," 0"),display:"flex",position:"relative"},fromOther:{backgroundColor:"rgba(128, 128, 128,.2)",borderRadius:"0 12px 12px 12px",marginLeft:72},fromUsr:{backgroundColor:"rgba(144,202,255,0.2)",marginLeft:"auto",marginRight:72,borderRadius:"12px 12px 0 12px"},usrJoint:{borderTopRightRadius:0},otherJoint:{borderBottomLeftRadius:0},nextJoint:{"&>span":{display:"none"},paddingTop:8},noPadding:{paddingTop:0},first:{paddingTop:e.spacing(1)},last:{paddingBottom:e.spacing(1)}}}));function tt(e){var t=["primary.light","primary.main","primary.dark","secondary.light","secondary.main","secondary.dark"];return{sx:{bgcolor:t[Math.floor(Math.random()*t.length)]},children:Object(we.jsx)(me.a,{})}}var nt=Object(Le.a)(Ke.a)((function(e){var t=e.theme;return{"& .MuiBadge-badge":{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(t.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",border:"1px solid currentColor",content:'""'}},"&:active":{transform:"translateY(2px)"}}})),rt=[{name:"Owner",color:"#fbc02d"},{name:"Wang",color:"#1e88e5"},{name:"Lol",color:"#ef5350"},{name:"Testers",color:"#ab47bc"},{name:"Die-no",color:"#4caf50"},{name:"A very long role that will be truncated",color:"#26a69a"},{name:"Lower roles have less priority",color:"#78909c"}],at=Object(Le.a)("li")((function(e){return{margin:e.theme.spacing(.25)}})),ct=function(e){var t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Boolean(a);return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(N.a,{title:"Online",children:Object(we.jsx)(nt,{sx:Object(C.a)({position:"absolute"},e.fromUsr?"right":"left",16),anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",variant:"dot",onClick:function(e){return c(e.currentTarget)},children:Object(we.jsx)(Q.a,Object(A.a)({},tt(e.uid)))})}),Object(we.jsxs)(Ne.a,{open:i,anchorEl:a,onClose:function(){return c(null)},PaperProps:{sx:{width:300,transform:"translateX(".concat(e.fromUsr?-16:16,"px)"),position:"relative",backgroundImage:"none"}},anchorOrigin:{vertical:"center",horizontal:e.fromUsr?"left":"right"},transformOrigin:{vertical:"center",horizontal:e.fromUsr?"right":"left"},children:[Object(we.jsx)(K.a,{sx:{bgcolor:"primary.main",overflow:"hidden",display:"flex",flexDirection:"column",height:60,width:"inherit"}}),Object(we.jsx)(N.a,{title:"Online",children:Object(we.jsx)(Ke.a,{sx:{position:"absolute",top:16,left:16,borderRadius:"50%",border:function(e){return"6px solid ".concat(e.palette.background.default)},"& > span.MuiBadge-badge":{border:function(e){return"6px solid ".concat(e.palette.background.default)},width:28,height:28,borderRadius:"50%"}},badgeContent:" ",color:"success",anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",children:Object(we.jsx)(Q.a,{sx:{width:80,height:80}})})}),Object(we.jsx)(M.a,{align:"center",p:"64px 16px 0",fontWeight:700,children:e.uid}),Object(we.jsx)(M.a,{align:"center",variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"User status goes here"}),Object(we.jsx)(G.a,{}),Object(we.jsx)(M.a,{variant:"overline",fontWeight:700,mx:2,children:"Roles"}),Object(we.jsxs)("ul",{style:{display:"flex",flexWrap:"wrap",listStyle:"none",padding:8,paddingTop:0,margin:0},children:[rt.map((function(e){return Object(we.jsx)(at,{children:Object(we.jsx)(We.a,{variant:"outlined",sx:{"& span.MuiChip-label":{textOverflow:"ellipsis",maxWidth:80},borderColor:e.color},size:"small",label:e.name,onDelete:function(){}})},e.name)})),Object(we.jsx)(at,{children:Object(we.jsx)("div",{style:{width:24,height:24,borderRadius:"50%",border:"1px solid #616161",marginTop:1,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},children:Object(we.jsx)(oe.a,{sx:{width:20,height:20}})})})]}),Object(we.jsx)(G.a,{}),Object(we.jsx)(J.a,{label:"Note",variant:"filled",sx:{m:1,width:"calc(100% - 16px)"}}),Object(we.jsx)(G.a,{}),Object(we.jsxs)(ge.a,{sx:{p:0},dense:!0,children:[Object(we.jsxs)(H.b,{button:!0,children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(oe.a,{})}),Object(we.jsx)(q.a,{children:"Create Chat"})]}),Object(we.jsxs)(H.b,{button:!0,children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(me.a,{})}),Object(we.jsx)(q.a,{children:"View Profile"})]})]})]})]})},it=Object(r.memo)((function(e){var t,n,a=e.msg,c=e.uid,i=e.userUID,s=e.prevJoint,o=e.nextJoint,l=e.first,u=e.last,b=e.grpTitle,j=e.purpose,h=e.sb,x=et(),p=Object(r.useState)(!1),O=Object(d.a)(p,2),m=O[0],f=O[1],g=Object(r.useState)([]),v=Object(d.a)(g,2),y=v[0],w=v[1],k=c===i;return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(Z.a,{open:m,onClose:function(){return f(!1)},children:[Object(we.jsxs)(te.a,{sx:{paddingBottom:0},children:[Object(we.jsx)("img",{src:a,alt:"",style:{maxWidth:"100%",minWidth:"100px",borderRadius:7},draggable:!1}),Object(we.jsx)(M.a,{maxWidth:"fit-content",variant:"subtitle2",children:"Image Caption"})]}),Object(we.jsxs)(re.a,{sx:{pt:0},children:[Object(we.jsx)(ae.a,{onClick:function(){return f(!1)},children:"Close"}),Object(we.jsx)("div",{style:{flexGrow:1}}),Object(we.jsx)(N.a,{title:"Download Media",children:Object(we.jsx)(W.a,{href:a,download:"Media from ".concat(b),children:Object(we.jsx)(Ge.a,{})})}),Object(we.jsx)(N.a,{title:"Delete locally stored image",children:Object(we.jsx)(W.a,{children:Object(we.jsx)(he.a,{})})})]})]}),l&&Object(we.jsxs)("div",{style:{padding:".5rem 1rem"},children:[Object(we.jsx)(Q.a,{sx:{width:96,height:96,mt:1}}),Object(we.jsx)(M.a,{variant:"h3",my:1,fontWeight:700,fontSize:36,children:b}),Object(we.jsxs)(M.a,{color:"text.secondary",gutterBottom:!0,children:["This is the start of the ",b," chat."]}),Object(we.jsx)(G.a,{})]}),Object(we.jsxs)("div",{className:Object(Be.a)(x.holder,(t={},Object(C.a)(t,x.noPadding,o),Object(C.a)(t,x.first,l),Object(C.a)(t,x.last,u),t)),children:[Object(we.jsxs)("div",{className:Object(Be.a)(x.msgBubble,(n={},Object(C.a)(n,x.usrJoint,k&&o),Object(C.a)(n,x.otherJoint,!k&&s),Object(C.a)(n,x.fromUsr,k),Object(C.a)(n,x.fromOther,!k),Object(C.a)(n,x.nextJoint,o),n)),children:[Object(we.jsx)(M.a,{variant:"caption",color:"text.secondary",children:c}),"img"===j&&Object(we.jsx)(U.a,{sx:{borderRadius:function(e){return e.shape.borderRadius+"px"},width:"-webkit-fill-available",overflow:"hidden",mt:"2px",display:"flex",maxWidth:"100%"},onClick:function(){return f(!0)},children:Object(we.jsx)("img",{src:a,alt:"",style:{width:"100%",minWidth:50,maxWidth:600},draggable:!1})}),("txt"===j||"img"===j)&&Object(we.jsx)(M.a,{mt:"img"===j?"0!important":"inherit",children:Object(we.jsx)(ze.a,{options:{defaultProtocol:"https",target:{url:"_blank"},formatHref:function(e,t){return w((function(t){return t.includes(e)?t:[].concat(Object(S.a)(t),[e])})),e}},children:"img"===j?"Image caption":a})}),y.map((function(e){return Object(we.jsx)(Ze,{url:e,sb:h},e)}))]}),!o&&Object(we.jsx)(ct,{uid:c,fromUsr:k})]})]})})),st=n(133);function ot(e){var t=Object(r.useRef)(),n=Object(r.useState)(!1),a=Object(d.a)(n,2),c=a[0],i=a[1],s=Object(r.useState)(!1),o=Object(d.a)(s,2),l=o[0],u=o[1],b=function(){!c&&l&&setTimeout((function(){return t.current.scrollToIndex({index:e.c.length,align:"end",behavior:"auto"})}),1)};return Object(we.jsx)("div",{style:{minHeight:0,display:"flex",flex:"1 1 auto",justifyContent:"center",overflowY:"auto"},children:Object(we.jsx)("div",{style:{minHeight:"100%",width:"100%",position:"relative"},children:Object(we.jsx)(st.a,{isScrolling:i,atBottomStateChange:u,ref:t,style:{padding:"10px 0"},initialTopMostItemIndex:e.c.length,overscan:2e3,alignToBottom:!0,followOutput:function(){return"smooth"},totalCount:e.c.length,itemContent:function(t){var n,r,a,c,i,s,o,l;return Object(we.jsx)(it,{prevJoint:(null===(n=e.c[t+1])||void 0===n?void 0:n.uid.trim())===(null===(r=e.c[t])||void 0===r?void 0:r.uid.trim()),first:0===t,nextJoint:(null===(a=e.c[t-1])||void 0===a?void 0:a.uid.trim())===(null===(c=e.c[t])||void 0===c?void 0:c.uid.trim()),last:t===e.c.length-1,grpTitle:e.gl[e.cg].name,purpose:null!==(i=null===(s=e.c[t])||void 0===s?void 0:s.purpose)&&void 0!==i?i:"txt",sb:b,userUID:e.uid,uid:null===(o=e.c[t])||void 0===o?void 0:o.uid,msg:null===(l=e.c[t])||void 0===l?void 0:l.msg},t)}},e.vKey)})})}var lt=Object(r.memo)(ot);function dt(e){return ut.apply(this,arguments)}function ut(){return(ut=Object(l.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new TextEncoder).encode(t),e.next=3,crypto.subtle.digest("SHA-256",n);case 3:return r=e.sent,a=Array.from(new Uint8Array(r)),e.abrupt("return",a.map((function(e){return e.toString(16).padStart(2,"0")})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bt=function(){var e=Object(l.a)(o.a.mark((function e(t,n,r){var a,c,i,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",n.current.pri,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["decrypt"]);case 2:return a=e.sent,e.next=5,window.crypto.subtle.decrypt({name:"RSA-OAEP"},a,O(v.decompressFromUTF16(t.key)));case 5:return c=e.sent,e.next=8,window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt","decrypt"]);case 8:return i=e.sent,e.next=11,g({data:t.data,iv:v.decompressFromUTF16(t.iv)},i);case 11:if(s=e.sent,r&&r[t.uid]){e.next=14;break}return e.abrupt("return",{content:"The public keys required to verify this message are missing. Please recreate this chat.",purpose:"txt"});case 14:return e.next=16,window.crypto.subtle.importKey("jwk",r[t.uid],{name:"ECDSA",namedCurve:"P-521"},!1,["verify"]);case 16:return l=e.sent,e.next=19,window.crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-512"}},l,O(v.decompressFromUTF16(t.sig)),(new TextEncoder).encode(JSON.stringify({data:t.data,iv:t.iv,gid:t.gid,id:t.target,purpose:t.purpose,key:t.key,act:"sendTxt"})));case 19:if(e.sent){e.next=22;break}return e.abrupt("return",{content:"Failed to verify authenticity of this message",purpose:"txt"});case 22:return e.abrupt("return",{content:v.decompressFromUTF16(s),purpose:t.purpose});case 23:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),jt=function(){var e=Object(l.a)(o.a.mark((function e(t,n,r,a,c,i,s,d){var u,b,j,h,x,p;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return u=e.sent,e.next=5,f(v.compressToUTF16(r.trim()),u);case 5:return b=e.sent,j=b.data,h=b.iv,e.next=10,window.crypto.subtle.exportKey("raw",u);case 10:if(x=e.sent,p=function(){var e=Object(l.a)(o.a.mark((function e(r){var i,s,l,u,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",r,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["encrypt"]);case 2:return i=e.sent,e.next=5,window.crypto.subtle.encrypt({name:"RSA-OAEP"},i,x);case 5:return s=e.sent,l={data:j,iv:v.compressToUTF16(h),gid:t,id:n,purpose:a,key:v.compressToUTF16(m(s)),act:"sendTxt"},console.log(l),e.next=10,window.crypto.subtle.importKey("jwk",c.current.priSign,{name:"ECDSA",namedCurve:"P-521"},!1,["sign"]);case 10:return u=e.sent,e.next=13,window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-512"}},u,(new TextEncoder).encode(JSON.stringify(l)));case 13:return b=e.sent,e.next=16,d(JSON.stringify(Object(A.a)(Object(A.a)({},l),{},{sig:v.compressToUTF16(m(b))})));case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.current[n]){e.next=18;break}return e.next=15,d(JSON.stringify({act:"getPub",uid:n}));case 15:s.current[n]=p,e.next=20;break;case 18:return e.next=20,p(i.current[n]);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c,i,s,o){return e.apply(this,arguments)}}(),ht=n(117),xt=n(244),pt=n(265),Ot=n(258),mt=n(300),ft=n(298),gt=n(299),vt=n(79),yt=n(118),wt=n(76),kt=n(119),St=n(245),Ct=n(246),At=n(248),Dt=n(249),Tt=n(250),It=n(251),Rt=r.forwardRef((function(e,t){return Object(we.jsx)(xt.a,Object(A.a)({direction:"up",ref:t},e))}));function Pt(e){var t=e.children,n=e.value,r=e.index,a=Object(ht.a)(e,["children","value","index"]);return Object(we.jsx)("div",Object(A.a)(Object(A.a)({role:"tabpanel",hidden:n!==r},a),{},{children:n===r&&Object(we.jsx)(K.a,{sx:{p:1.5},children:t})}))}function Ft(e){var t,n,a,c,i=e.d,s=e.cg,o=e.cl,l=e.sCl,u=e.rsk,b=e.sMeta,j=[{icon:Object(we.jsx)(wt.a,{}),title:"Overview"},{icon:Object(we.jsx)(le.a,{}),title:"Security"},{icon:Object(we.jsx)(St.a,{}),title:"Roles"},{icon:Object(we.jsx)(Ct.a,{}),title:"Members"}],h=Object(r.useState)(0),x=Object(d.a)(h,2),p=x[0],O=x[1],m=Object(r.useState)({}),f=Object(d.a)(m,2),g=f[0],v=f[1],y=Object(r.useState)({}),w=Object(d.a)(y,2),D=w[0],T=w[1],I=Object(r.useState)([{name:"Owner",color:"#fbc02d"},{name:"Wang",color:"#1e88e5"},{name:"Lol",color:"#ef5350"},{name:"Testers",color:"#ab47bc"},{name:"Die-no",color:"#4caf50"},{name:"A very long role that will be truncated",color:"#26a69a"},{name:"Lower roles have less priority",color:"#78909c"}]),R=Object(d.a)(I,2),P=R[0],U=(R[1],Object(r.useState)(0)),L=Object(d.a)(U,2),z=L[0],X=L[1],$=Object(r.useState)(""),ee=Object(d.a)($,2),te=ee[0],ne=ee[1],re=Object(r.useState)("appear"),ce=Object(d.a)(re,2),ie=ce[0],se=ce[1],oe=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){var r,a;if(n?(r=D,a=T):(r=g,a=v),r[t]){var c=r[t].indexOf(e),i=Object(S.a)(r[t]);-1===c?i.push(e):i.splice(c,1),a((function(e){return Object(A.a)(Object(A.a)({},e),{},Object(C.a)({},t,i))}))}else a((function(n){return Object(A.a)(Object(A.a)({},n),{},Object(C.a)({},t,[e]))}))}},de=function(){e.so(!1),O(0),ne("")};return Object(we.jsx)(Z.a,{open:e.open,onClose:de,TransitionComponent:Rt,fullScreen:!0,PaperProps:{elevation:8},children:Object(we.jsxs)(K.a,{sx:{display:"flex"},children:[Object(we.jsx)(k.a,{}),Object(we.jsx)(F.a,{position:"fixed",sx:{zIndex:function(e){return e.zIndex.drawer+1}},children:Object(we.jsxs)(E.a,{children:[Object(we.jsx)(W.a,{edge:"start",color:"inherit",onClick:de,"aria-label":"close",children:Object(we.jsx)(yt.a,{})}),Object(we.jsxs)(M.a,{sx:{ml:2,flex:1},variant:"h6",noWrap:!0,component:"div",children:["Chat Settings for ",i.name]})]})}),Object(we.jsxs)(ft.a,{sx:{width:240,flexShrink:0,"& .MuiDrawer-paper":{width:240,boxSizing:"border-box",border:"none"}},PaperProps:{elevation:4},variant:"permanent",anchor:"left",children:[Object(we.jsx)(E.a,{}),Object(we.jsx)(ge.a,{children:j.map((function(e,t){return Object(we.jsxs)(H.b,{button:!0,onClick:function(){return O(t)},selected:p===t,children:[Object(we.jsx)(V.a,{children:e.icon}),Object(we.jsx)(q.a,{primary:e.title})]},e.title)}))})]}),Object(we.jsxs)(K.a,{component:"main",sx:{flexGrow:1,p:3},children:[Object(we.jsx)(E.a,{}),0===p&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(M.a,{variant:"h4",gutterBottom:!0,children:"Overview"}),Object(we.jsx)(M.a,{variant:"subtitle1",gutterBottom:!0,children:"A bird's eye view of this chat"}),Object(we.jsx)(G.a,{}),Object(we.jsxs)(K.a,{sx:{display:"flex",alignItems:"center",my:2},children:[Object(we.jsxs)(K.a,{sx:{mr:2,position:"relative"},children:[Object(we.jsxs)(K.a,{sx:{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",background:"#00000066",opacity:0,top:0,left:0,right:0,bottom:0,zIndex:2,transition:function(e){return e.transitions.create(["opacity"])},backdropFilter:"blur(6px)",padding:"15%",borderRadius:"50%",flexDirection:"column","&:hover":{opacity:1}},children:[Object(we.jsx)(M.a,{align:"center",mb:1,variant:"button",fontWeight:700,children:"Change Icon"}),Object(we.jsx)(ae.a,{startIcon:Object(we.jsx)(kt.a,{}),variant:"outlined",children:"Upload"})]}),Object(we.jsx)(Q.a,{sx:{width:150,height:150}})]}),Object(we.jsx)(G.a,{orientation:"vertical",flexItem:!0,sx:{mr:2}}),Object(we.jsxs)(K.a,{sx:{display:"flex",flexDirection:"column",flex:1},children:[Object(we.jsx)(M.a,{variant:"h6",gutterBottom:!0,children:"Chat Info"}),Object(we.jsx)(J.a,{variant:"filled",label:"Title",value:i.name}),Object(we.jsx)(J.a,{variant:"outlined",label:"Description",multiline:!0,sx:{mt:2},maxRows:5})]})]}),Object(we.jsx)(G.a,{}),Object(we.jsxs)(ge.a,{children:[Object(we.jsxs)(H.b,{children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(vt.a,{})}),Object(we.jsx)(q.a,{id:"sl-disc",primary:"Public Chat",secondary:"Allow random people to join your chat"}),Object(we.jsx)(pt.a,{edge:"end",onChange:oe("discovery",0),checked:(null!==(t=g[0])&&void 0!==t?t:[]).includes("discovery"),inputProps:{"aria-labelledby":"sl-disc"}})]}),Object(we.jsxs)(H.b,{children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(vt.a,{})}),Object(we.jsx)(q.a,{id:"sl-disc",primary:"Public Chat",secondary:"Allow random people to join your chat"}),Object(we.jsx)(pt.a,{edge:"end",onChange:oe("discovery",0),checked:(null!==(n=g[0])&&void 0!==n?n:[]).includes("discovery"),inputProps:{"aria-labelledby":"sl-disc"}})]})]}),Object(we.jsx)(G.a,{}),Object(we.jsx)(M.a,{variant:"h6",mt:1,children:"Leave chat"}),Object(we.jsxs)(M.a,{variant:"subtitle2",color:"text.secondary",mb:1.5,children:["Leaves this chat, and permanently deletes chat history stored in your browser. This action ",Object(we.jsx)("b",{children:"cannot"})," be undone. Proceed with caution."]}),Object(we.jsx)(ae.a,{variant:"outlined",color:"error",children:"Leave Chat"})]}),1===p&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(M.a,{variant:"h4",gutterBottom:!0,children:"Security"}),Object(we.jsx)(M.a,{variant:"subtitle1",gutterBottom:!0,children:"Change various security settings of your chat"}),Object(we.jsx)(G.a,{}),Object(we.jsxs)(ge.a,{children:[Object(we.jsxs)(H.b,{children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(le.a,{})}),Object(we.jsx)(q.a,{id:"e2ee-disc",primary:"Encrypted Chat",secondary:"Enables end to end encryption (cannot be undone)"}),Object(we.jsx)(pt.a,{edge:"end",onChange:oe("e2ee",1),checked:(null!==(a=g[1])&&void 0!==a?a:[]).includes("e2ee"),inputProps:{"aria-labelledby":"e2ee-disc"}})]}),Object(we.jsxs)(H.b,{children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(vt.a,{})}),Object(we.jsx)(q.a,{id:"lol-disc",primary:"Lol no",secondary:"Hey"}),Object(we.jsx)(pt.a,{edge:"end",onChange:oe("hm",1),checked:(null!==(c=g[1])&&void 0!==c?c:[]).includes("hm"),inputProps:{"aria-labelledby":"lol-disc"}})]})]})]}),2===p&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(M.a,{variant:"h4",gutterBottom:!0,children:"Roles"}),Object(we.jsx)(M.a,{variant:"subtitle1",gutterBottom:!0,children:"Edit and create user roles to manage permissions of members in this chat"}),Object(we.jsx)(G.a,{}),Object(we.jsxs)(K.a,{sx:{display:"flex",alignItems:"flex-start",mt:2},children:[Object(we.jsx)(B.a,{sx:{width:240,mr:1,overflow:"hidden"},children:Object(we.jsx)(ge.a,{sx:{p:0},children:P.map((function(e,t){return Object(we.jsxs)(H.b,{button:!0,onClick:function(){return X(t)},selected:z===t,children:[Object(we.jsx)(_.a,{children:Object(we.jsx)(Q.a,{sx:{background:e.color,width:36,height:36},children:e.name.slice(0,1)})}),Object(we.jsx)(q.a,{primary:e.name,primaryTypographyProps:{noWrap:!0}})]},e.name)}))})}),Object(we.jsxs)(B.a,{sx:{ml:1,flex:1,px:1,pt:1},children:[Object(we.jsxs)(M.a,{variant:"button",fontWeight:700,m:1,component:"h6",children:["Edit Role: ",P[z].name]}),Object(we.jsxs)(K.a,{sx:{width:"100%",typography:"body1"},children:[Object(we.jsx)(K.a,{sx:{borderBottom:1,borderColor:"divider"},children:Object(we.jsxs)(Ot.a,{onChange:function(e,t){return se(t)},value:ie,children:[Object(we.jsx)(gt.a,{label:"Appearance",value:"appear"}),Object(we.jsx)(gt.a,{label:"Permissions",value:"perms"}),Object(we.jsx)(gt.a,{label:"Manage Users",value:"usrMgmt"})]})}),Object(we.jsxs)(Pt,{index:"appear",value:ie,children:[Object(we.jsx)(M.a,{gutterBottom:!0,children:"Name"}),Object(we.jsx)(J.a,{variant:"filled",label:"Role Name",sx:{mb:2},value:P[z].name,fullWidth:!0}),Object(we.jsx)(G.a,{sx:{mb:2}}),Object(we.jsx)(M.a,{gutterBottom:!0,children:"Display Color"}),Object(we.jsx)(K.a,{})]}),Object(we.jsxs)(Pt,{index:"perms",value:ie,children:[Object(we.jsx)(J.a,{variant:"outlined",label:"Search permissions",fullWidth:!0,size:"small",sx:{my:.5}}),Object(we.jsx)(ge.a,{sx:{pb:0},children:[{title:"General Permissions"},{title:"Manage Roles",desc:"Edit and create roles (what you're doing now)",key:1},{title:"Member Permissions"},{title:"Create Invite",desc:"Create a chat invite for others to join the chat",key:2},{title:"Kick Members",desc:"Remove members from the chat",key:3},{title:"Ban Members",desc:"Permanently block a member from the chat",key:4},{title:"Text Permissions"},{title:"Send Messages",desc:"Send text messages in the chat",key:5},{title:"Attach Files",desc:"Send messages with attachments (i.e. images, videos etc.)",key:6},{title:"Delete Messages",desc:"Allows members to delete their own messages",key:7},{title:"Manage Messages",desc:"Allows members to delete other's messages and pin messages",key:8},{title:"Advanced Permissions"},{title:"Administrator",desc:"Grant user all permissions",key:0}].map((function(e){var t,n,r,a=(null!==(t=e.key)&&void 0!==t?t:e.title.replace(" ","")).toString();return Object(we.jsxs)(H.b,{sx:e.desc?{}:{py:0},disableGutters:!0,children:[Object(we.jsx)(q.a,{id:a+"-disc",secondaryTypographyProps:e.desc?{}:{variant:"button",fontWeight:700,fontSize:13},primary:e.desc?e.title:"",secondary:null!==(n=e.desc)&&void 0!==n?n:e.title}),e.desc&&Object(we.jsx)(pt.a,{edge:"end",onChange:oe(a,z,!0),checked:(null!==(r=D[z])&&void 0!==r?r:[]).includes(a),inputProps:{"aria-labelledby":a+"-disc"}})]},a)}))})]}),Object(we.jsxs)(Pt,{index:"usrMgmt",value:ie,children:[Object(we.jsx)(M.a,{children:"People who have this row:"}),Object(we.jsxs)(ge.a,{sx:{pb:0},children:[Object(we.jsxs)(H.b,{disableGutters:!0,children:[Object(we.jsx)(q.a,{children:"A person"}),Object(we.jsx)(Y.a,{children:Object(we.jsx)(W.a,{children:Object(we.jsx)(At.a,{})})})]}),Object(we.jsxs)(H.b,{disableGutters:!0,children:[Object(we.jsx)(q.a,{children:"Another person"}),Object(we.jsx)(Y.a,{children:Object(we.jsx)(W.a,{children:Object(we.jsx)(At.a,{})})})]})]})]})]})]})]})]}),3===p&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(M.a,{variant:"h4",gutterBottom:!0,children:"Member Management"}),Object(we.jsx)(M.a,{variant:"subtitle1",gutterBottom:!0,children:"Add, remove or ban users"}),Object(we.jsx)(G.a,{sx:{mb:2}}),Object(we.jsx)(M.a,{variant:"button",children:"Add members"}),Object(we.jsxs)(K.a,{display:"flex",mt:1,alignItems:"center",children:[Object(we.jsx)(J.a,{variant:"filled",label:"Member UID",value:te,onChange:function(e){return ne(e.currentTarget.value)},sx:{flex:1}}),Object(we.jsx)(N.a,{title:"Add member to chat",children:Object(we.jsx)(W.a,{sx:{mx:.5},onClick:function(){l((function(e){var t=Object(A.a)({},e);return t[s].people.push(te),b(s,t),t})),u(te),ne("")},children:Object(we.jsx)(Dt.a,{})})})]}),Object(we.jsx)(G.a,{sx:{my:2}}),Object(we.jsx)(M.a,{variant:"button",children:"Manage members"}),Object(we.jsx)(ge.a,{sx:{"& > li":{display:"flex","& > div.MuiListItem-root":{pr:1},"& > div.MuiListItemSecondaryAction-root":{transform:"none",position:"relative"}}},children:s&&o[s].people.map((function(t){return Object(we.jsxs)(H.b,{disableGutters:!0,children:[Object(we.jsxs)(q.a,{children:[t,t===e.uid&&Object(we.jsx)(we.Fragment,{children:" (You)"})]}),Object(we.jsx)(Y.a,{children:Object(we.jsxs)(K.a,{display:"flex",alignItems:"center",children:[Object(we.jsx)(mt.a,{max:P.length,children:P.map((function(e){return Object(we.jsx)(N.a,{title:e.name,children:Object(we.jsx)(Q.a,{sx:{width:24,height:24,fontSize:18,background:e.color},children:e.name.slice(0,1)})},e.name)}))}),Object(we.jsx)(N.a,{title:"Ban member",children:Object(we.jsx)(W.a,{sx:{mx:.25},children:Object(we.jsx)(Tt.a,{})})}),Object(we.jsx)(N.a,{title:"Remove member",children:Object(we.jsx)(W.a,{sx:{mx:.25},children:Object(we.jsx)(It.a,{})})})]})})]},t)}))})]})]})]})})}var Et=n(252),Mt=n(253),Ut=Object(se.a)((function(e){return{container:{minHeight:"calc(100vh - 64px)",padding:e.spacing(2),display:"grid",gridTemplateColumns:"auto 1fr",gridGap:e.spacing(1.5)},code:{backgroundColor:e.palette.background.paper,border:"2px solid rgba(128, 128, 128, .5)",borderRadius:e.shape.borderRadius,padding:"".concat(e.spacing(.3)," ").concat(e.spacing(.5)),margin:"".concat(e.spacing(.5)," ").concat(e.spacing(.4)),display:"block",fontFamily:"Courier"},minimizeArrow:{transform:"rotate(0deg)",transition:e.transitions.create("transform")},rotatedArrow:{transform:"rotate(180deg)"}}})),Bt={},Kt="",Nt={};function Wt(e){var t,n=Ut(),a=e.ss,c=[{col:"#808080",label:"Connecting..."},{col:"#ff0000",label:"Error"},{col:"#00ff00",label:"Connected"},{col:"#ff8000",label:"Disconnected"}],i=Object(r.useState)(null),s=Object(d.a)(i,2),u=s[0],b=s[1],j=Object(r.useState)(null),h=Object(d.a)(j,2),x=h[0],p=h[1],O=Object(r.useState)(null),m=Object(d.a)(O,2),f=m[0],g=m[1],v=Object(r.useState)({}),y=Object(d.a)(v,2),w=y[0],k=y[1],R=Object(r.useState)({open:!1,msg:"",type:"success"}),se=Object(d.a)(R,2),ge=se[0],ve=se[1],ye=Object(r.useState)(0),ke=Object(d.a)(ye,2),Ce=ke[0],De=ke[1],Te=Object(r.useState)(""),Ie=Object(d.a)(Te,2),Re=Ie[0],Pe=Ie[1],Fe=Object(r.useState)([]),Ee=Object(d.a)(Fe,2),Me=Ee[0],Ke=Ee[1],Ne=Object(r.useState)(!1),We=Object(d.a)(Ne,2),Le=We[0],Je=We[1],ze=Object(r.useState)(!1),Ge=Object(d.a)(ze,2),He=Ge[0],Ve=Ge[1],qe=Object(r.useState)(!1),Ye=Object(d.a)(qe,2),Xe=Ye[0],$e=Ye[1],_e=Object(r.useState)(""),Qe=Object(d.a)(_e,2),Ze=Qe[0],et=Qe[1],tt=Object(r.useState)({open:!1}),nt=Object(d.a)(tt,2),rt=nt[0],at=nt[1],ct=Object(r.useState)(""),it=Object(d.a)(ct,2),st=it[0],ot=it[1],ut=Object(r.useState)(0),ht=Object(d.a)(ut,2),xt=ht[0],pt=ht[1],Ot=Object(r.useState)({name:"",gid:""}),mt=Object(d.a)(Ot,2),ft=mt[0],gt=mt[1],vt=Object(r.useState)(!1),yt=Object(d.a)(vt,2),wt=yt[0],kt=yt[1],St=Object(r.useState)({}),Ct=Object(d.a)(St,2),At=Ct[0],Dt=Ct[1],Tt=Object(r.useState)(!1),It=Object(d.a)(Tt,2),Rt=It[0],Pt=It[1],Wt=Object(r.useState)(!1),Lt=Object(d.a)(Wt,2),Jt=Lt[0],zt=Lt[1],Gt=Object(r.useState)(0),Ht=Object(d.a)(Gt,2),Vt=Ht[0],qt=Ht[1],Yt=Object(r.useRef)({}),Xt=Object(r.useRef)({}),$t=Object(r.useRef)({}),_t=Object(r.useRef)(),Qt=Object(r.useRef)({}),Zt=Object(r.useRef)({}),en=Boolean(f),tn=Object(r.useState)({disabled:!1}),nn=Object(d.a)(tn,2),rn=nn[0],an=nn[1],cn=Boolean(x),sn=function(){var e=Object(r.useRef)(!0);return Object(r.useEffect)((function(){e.current=!1}),[]),e.current}(),on=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(Bt[u]=Me),a.setVal("chatData",JSON.stringify(Bt)).then(),console.log("Chats:",Me),console.error("Syncing",Bt)},ln=function(){a.setVal("signKeys",Nt).then()},dn=function(){var e=Object(l.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=at,e.t1=t,e.t2=n,e.next=5,dt(n);case 5:e.t3=e.sent,e.t4={uid:e.t1,key:e.t2,hash:e.t3,open:!0,mode:0},(0,e.t0)(e.t4);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),un=function(e,t){var n=t||w[e];n&&n[e].people.forEach((function(t){t!==Kt&&jt(e,t,JSON.stringify(n[e]),"metaUpdate",$t,Yt,Qt,jn).then((function(){return P("main","Sent meta update to",t)}))}))},bn=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Nt||(Nt={},ln()),!Nt[t]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,jn(JSON.stringify({act:"getSignPub",target:t}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){sn||(a.setVal("chats",JSON.stringify(w)).then(),0===Object.keys(w).length&&Pt(!1))}),[w]),Object(r.useEffect)((function(){0!==Me.length&&0!==Object.keys(Bt).length&&on()}),[Me]),Object(r.useEffect)((function(){var e,t=null!==(e=Bt[u])&&void 0!==e?e:[];Ke(t),qt((function(e){return++e})),console.error(Bt)}),[u]),Object(r.useEffect)((function(){an(2===Ce?{disabled:!1}:{disabled:!0,icon:Object(we.jsx)(Et.a,{}),label:"WebSocket Disconnected"})}),[Ce]);var jn=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(_t&&1===_t.current.readyState){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,_t.current.send(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),hn=function e(){_t.current=new WebSocket("wss://api.chattyapp.cf:443");var t=null,n=+new Date,r=function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn(JSON.stringify({act:"ping"}));case 2:n=+new Date;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();_t.current.onopen=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==Ce){e.next=2;break}return e.abrupt("return");case 2:return De(2),e.next=5,jn(JSON.stringify({uid:Kt}));case 5:return e.next=7,jn(JSON.stringify({act:"updatePub",key:Xt.current.pub}));case 7:return e.next=9,jn(JSON.stringify({act:"updateSign",key:$t.current.pubSign}));case 9:return e.next=11,r();case 11:t=setInterval(r,3e3);case 12:case"end":return e.stop()}}),e)}))),_t.current.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(a){return}switch(P("main","Received WebSocket message:",JSON.stringify(t)),t.resp){case"pong":pt(new Date-n);break;case"txtMsg":var r=!0;k((function(e){if(!r)return Object(A.a)(Object(A.a)({},e),{},Object(C.a)({},t.gid,{name:"Unknown chat",people:[t.uid]}));r=!1;var n=function(){bt(t,Xt,Nt).then((function(n){var r={msg:n.content,uid:t.uid,purpose:n.purpose};if(e[t.gid].people.includes(r.uid))if("txt"===r.purpose||"img"===r.purpose){var a=null;b((function(e){return a=e,e})),Bt[t.gid]||(Bt[t.gid]=[]),t.gid===a?Ke((function(e){return[].concat(Object(S.a)(e),[r])})):Bt[t.gid].push(r)}else if("metaUpdate"===r.purpose){var c=JSON.parse(r.msg);k((function(e){return Object(A.a)(Object(A.a)({},e),{},Object(C.a)({},t.gid,c))})),c.people.forEach((function(e){return bn(e)}))}}))};return e[t.gid]?(n(),e):(Nt||(Nt={}),Bt[t.gid]||(Bt[t.gid]=[]),Nt[t.uid]?n():(bn(t.uid).then(),Zt.current={uid:t.uid,act:n}),Object(A.a)(Object(A.a)({},e),{},Object(C.a)({},t.gid,{name:"Unknown chat",people:[t.uid]})))}));break;case"pubKey":Yt.current=Object(A.a)(Object(A.a)({},Yt.current),{},Object(C.a)({},t.uid,t.pub)),Qt.current&&Qt.current[t.uid]&&(Qt.current[t.uid](t.pub),delete Qt.current[t.uid]);break;case"signKey":if(Nt||(Nt={}),Nt[t.uid])return;dn(t.uid,t.pub).then()}},_t.current.onclose=function(){De(3),clearInterval(t),setTimeout(e,5e3)},_t.current.onerror=function(){De(1)}};Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){var t,n,r,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getVal("pubKey");case 2:return t=e.sent,e.next=5,a.getVal("priKey");case 5:return n=e.sent,Xt.current={pub:t,pri:n},e.next=9,a.getVal("signPub");case 9:return r=e.sent,e.next=12,a.getVal("signPri");case 12:return c=e.sent,$t.current={pubSign:r,priSign:c},e.next=16,a.getVal("signKeys");case 16:return Nt=e.sent,e.next=19,a.getVal("uid");case 19:return Kt=e.sent,e.next=22,a.getVal("chats");case 22:return i=e.sent,k(i?JSON.parse(i):{}),e.next=26,a.getVal("chatData");case 26:s=e.sent,Bt=s?JSON.parse(s):{},hn();case 29:case"end":return e.stop()}}),e)})))()}),[]);var xn=function(){Je(!1),gt({name:"",gid:""})},pn=function(){return Ve(!1)},On=function(){return p(null)},mn=function(){return g(null)},fn=function(){return $e(!1)};return Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)("div",{style:{minHeight:"100vh"},children:[Object(we.jsx)(F.a,{position:"relative",elevation:18,children:Object(we.jsxs)(E.a,{children:[Object(we.jsx)("img",{src:pe,width:32,height:32,alt:""}),Object(we.jsx)(M.a,{variant:"h6",component:"div",sx:{flexGrow:1,ml:2.5},children:"Chatty"}),Object(we.jsx)(U.a,{sx:{borderRadius:function(e){return e.shape.borderRadius+"px"}},children:Object(we.jsxs)(B.a,{sx:{padding:"4px 12px",display:"flex",alignItems:"center"},elevation:4,children:[Object(we.jsx)("div",{style:{width:10,height:10,borderRadius:"50%",marginRight:"8px",backgroundColor:c[Ce].col}}),Object(we.jsxs)(M.a,{variant:"subtitle1",children:[c[Ce].label,2===Ce&&Object(we.jsxs)(we.Fragment,{children:[" \u2022 RT: ",xt,"ms"]})]})]})}),Object(we.jsxs)(K.a,{display:"flex",ml:1.5,children:[Object(we.jsx)(N.a,{title:"Settings",children:Object(we.jsx)(W.a,{edge:"end",color:"inherit","aria-label":"lock",sx:{m:.001},onClick:function(){},children:Object(we.jsx)(fe.a,{})})}),Object(we.jsx)(N.a,{title:"Lock vault",children:Object(we.jsx)(W.a,{edge:"end",color:"inherit","aria-label":"lock",onClick:function(){},children:Object(we.jsx)(le.a,{})})})]})]})}),Object(we.jsxs)("div",{className:n.container,children:[Object(we.jsx)(B.a,{elevation:6,sx:{overflow:"hidden"},children:Object(we.jsx)(L.a,{in:!Rt,collapsedSize:64,orientation:"horizontal",onExiting:function(){return zt(!1)},onExited:function(){return zt(!0)},children:Object(we.jsxs)(K.a,{sx:{width:350,display:"grid",gridTemplateRows:"auto 1fr auto",maxHeight:"calc(100vh - 96px)",height:"calc(100vh - 96px)"},children:[Object(we.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",width:"max-content",padding:"10px"},children:[Object(we.jsx)(L.a,{in:!Rt,orientation:"horizontal",sx:{"& .MuiCollapse-wrapperInner":{flex:1}},children:Object(we.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"fit-content"},children:[Object(we.jsx)(J.a,{variant:"outlined",label:"Search",value:Re,onChange:function(e){return Pe(e.target.value)},sx:{flexGrow:1,mr:1,width:"236px"}}),Object(we.jsx)(N.a,{title:"Create new chat",children:Object(we.jsx)(z.a,{color:"secondary","aria-label":"add",size:"medium",onClick:function(){return Je(!0)},children:Object(we.jsx)(oe.a,{})})})]})}),Object(we.jsx)(N.a,{title:0===Object.keys(w).length?"Add your first chat by clicking on the + button!":(Rt?"Un-m":"M")+"inimise chat list",children:Object(we.jsx)("span",{children:Object(we.jsx)(W.a,{size:"small",sx:{ml:1},disabled:0===Object.keys(w).length,onClick:function(){return Pt((function(e){return!e}))},children:Object(we.jsx)(Mt.a,{className:Object(Be.a)(n.minimizeArrow,Object(C.a)({},n.rotatedArrow,Rt))})})})})]}),Object(we.jsx)(Ae,{cl:w,sg:b,cg:u,cv:Rt,ac:Jt,q:Re,pk:Nt}),(!Rt||!Jt)&&Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(G.a,{}),Object(we.jsxs)(H.b,{button:!0,ContainerComponent:"div",id:"u-acc-btn",onClick:function(e){return g(e.currentTarget)},children:[Object(we.jsx)(V.a,{children:Object(we.jsx)(ue.a,{})}),Object(we.jsx)(q.a,{primary:"Your Account"}),Object(we.jsx)(Y.a,{children:Object(we.jsx)(N.a,{title:"Copy your UID",children:Object(we.jsx)(W.a,{edge:"end","aria-label":"",sx:{mr:1e-4},onClick:function(){navigator.clipboard.writeText(Kt).then((function(){return ve({open:!0,msg:"Copied UID!",type:"success"})}))},children:Object(we.jsx)(be.a,{})})})})]})]}),Object(we.jsxs)(X.a,{id:"u-acct-menu","aria-labelledby":"u-acc-btn",anchorEl:f,open:en,onClose:mn,sx:{"& .MuiSvgIcon-root":{color:"text.secondary",marginRight:1.5}},PaperProps:{style:{minWidth:300}},anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:[Object(we.jsxs)($.a,{onClick:mn,children:[Object(we.jsx)(me.a,{})," Profile"]}),Object(we.jsxs)($.a,{onClick:mn,children:[Object(we.jsx)(fe.a,{})," Account Settings"]}),Object(we.jsxs)($.a,{onClick:Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=at,e.next=3,dt($t.current.pubSign);case 3:e.t1=e.sent,e.t2={uid:null,key:null,hash:e.t1,open:!0,mode:1},(0,e.t0)(e.t2),mn();case 7:case"end":return e.stop()}}),e)}))),children:[Object(we.jsx)(Oe.a,{})," Verify Sign Key"]})]})]})})}),Object(we.jsx)(B.a,{sx:{flexGrow:1,position:"relative",display:"flex",flexDirection:"column",overflow:"hidden"},elevation:6,children:u?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)(H.b,{button:!0,divider:!0,ContainerComponent:"div",onClick:function(){Dt({name:w[u].name}),kt(!0)},children:[Object(we.jsx)(_.a,{children:Object(we.jsx)(Q.a,{children:Object(we.jsx)(de.a,{})})}),Object(we.jsx)(q.a,{secondaryTypographyProps:{noWrap:!0,mr:2},primary:w[u].name,secondary:w[u].people.join(", ")}),Object(we.jsxs)(Y.a,{children:[Object(we.jsx)(W.a,{edge:"end","aria-label":"",id:"more-btn","aria-controls":"more-menu",onClick:function(e){return p(e.currentTarget)},sx:{mr:1e-4},children:Object(we.jsx)(je.a,{})}),Object(we.jsxs)(X.a,{id:"more-menu",sx:{"& .MuiSvgIcon-root":{color:"text.secondary",marginRight:1.5}},MenuListProps:{"aria-labelledby":"more-btn"},anchorEl:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:cn,onClose:On,children:[Object(we.jsxs)($.a,{onClick:function(){b((function(e){return ot(w[e].name),$e(!0),On(),e}))},children:[Object(we.jsx)(xe.a,{}),"Edit Chat Title"]}),Object(we.jsxs)($.a,{onClick:function(){Ve(!0),On()},children:[Object(we.jsx)(he.a,{}),"Delete chat"]})]})]})]}),Object(we.jsx)(lt,{c:Me,uid:Kt,cg:u,gl:w,vKey:Vt}),Object(we.jsx)(Ue,{m:Ze,sm:et,send:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"txt",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;0!==(e=n||Ze.trim()).length&&(Ke([].concat(Object(S.a)(Me),[{msg:e,uid:Kt,purpose:t}])),et(""),w[u].people.forEach((function(n){n!==Kt&&jt(u,n,e,t,$t,Yt,Qt,jn).then((function(){return P("main","Sent to",n)}))})))},disableState:rn,n:w[u].name})]}):Object(we.jsx)(Se,{})})]})]}),Object(we.jsxs)(Z.a,{maxWidth:"xs",open:Le,onClose:xn,"aria-labelledby":"ac-d-t","aria-describedby":"ac-d-d",children:[Object(we.jsx)(ee.a,{id:"ac-d-t",children:"Create a new Chat!"}),Object(we.jsxs)(te.a,{children:[Object(we.jsx)(ne.a,{id:"ac-d-d",children:"Enter the UID of your first member. You can add others later."}),Object(we.jsx)(J.a,{variant:"filled",sx:{width:"100%"},label:"Name",value:ft.name,onChange:function(e){return gt(Object(A.a)(Object(A.a)({},ft),{},{name:e.target.value}))}}),Object(we.jsx)(J.a,{sx:{width:"100%",mt:2,"&>div":{fontFamily:"Courier"}},label:"UID",variant:"outlined",onChange:function(e){return gt(Object(A.a)(Object(A.a)({},ft),{},{gid:e.target.value}))},value:ft.gid})]}),Object(we.jsxs)(re.a,{children:[Object(we.jsx)(ae.a,{onClick:xn,children:"Close"}),Object(we.jsx)(ae.a,{onClick:function(){if(Object(I.a)(ft.gid)&&4===Object(T.a)(ft.gid)){var e=Object(D.a)(),t=!0;b(e),k((function(n){var r=Object(A.a)(Object(A.a)({},n),{},Object(C.a)({},e,{name:ft.name,people:[ft.gid,Kt]}));return t&&un(e,r),t=!1,r})),bn(ft.gid),xn()}},children:"Add"})]})]}),Object(we.jsxs)(Z.a,{maxWidth:"xs",open:He,onClose:pn,"aria-labelledby":"cd-d-t","aria-describedby":"cd-d-d",children:[Object(we.jsx)(ee.a,{id:"cd-d-t",children:"Delete chat?"}),Object(we.jsx)(te.a,{children:Object(we.jsx)(ne.a,{mb:"0!important",children:"All messages will be deleted. This action cannot be undone."})}),Object(we.jsxs)(re.a,{children:[Object(we.jsx)(ae.a,{onClick:pn,children:"Cancel"}),Object(we.jsx)("div",{style:{flexGrow:1}}),Object(we.jsx)(ae.a,{onClick:function(){var e=u;b(null),k((function(t){var n=Object(A.a)({},t);return delete n[e],n})),Ke([]),requestAnimationFrame((function(){delete Bt[e],on(!0)})),pn()},children:"Delete"})]})]}),Object(we.jsxs)(Z.a,{maxWidth:"xs",open:Xe,onClose:fn,"aria-labelledby":"ct-d-t","aria-describedby":"ct-d-d",children:[Object(we.jsx)(ee.a,{id:"ct-d-t",children:"Edit Chat Title"}),Object(we.jsxs)(te.a,{children:[Object(we.jsx)(ne.a,{children:"Enter a new title for this chat below. It does not need to be unique."}),Object(we.jsx)(J.a,{variant:"filled",value:st,onChange:function(e){return ot(e.target.value)},label:"New Chat Title",sx:{width:"100%"}})]}),Object(we.jsxs)(re.a,{children:[Object(we.jsx)(ae.a,{onClick:fn,children:"Cancel"}),Object(we.jsx)(ae.a,{onClick:function(){var e=!0;k((function(t){var n=Object(A.a)({},t);return n[u].name=st,e&&un(u,n),e=!1,n})),fn()},children:"Change Title"})]})]}),Object(we.jsxs)(Z.a,{open:rt.open,onClose:function(){return at({open:!1})},"aria-labelledby":"ct-d-t","aria-describedby":"ct-d-d",children:[Object(we.jsxs)(ee.a,{id:"ct-d-t",children:["Verify ",0===rt.mode?"New":"Your"," Public Key"]}),Object(we.jsx)(te.a,{children:Object(we.jsxs)(ne.a,{align:"center",mb:"0!important",children:[0===rt.mode&&Object(we.jsxs)(we.Fragment,{children:["Received a new public signing key from ",Object(we.jsx)("span",{className:n.code,children:rt.uid}),"Cross check the code below with this person to ensure this key is authentic. This ensures your messages can only be decrypted by your recipient."]}),1===rt.mode&&Object(we.jsx)(we.Fragment,{children:"Cross check the code below with the code your recipient received."}),Object(we.jsx)("span",{className:n.code,style:{fontWeight:900},children:null===rt||void 0===rt||null===(t=rt.hash)||void 0===t?void 0:t.join(" ")}),Object(we.jsxs)("small",{style:{display:"block",marginBottom:8},children:["Ask your recipient to click on [",0===rt.mode?"Your Account":"(Your icon in chat)"," > Verify Sign Key] to verify this key."]}),"You can delete signing keys at [Settings > Manage Signing Keys]"]})}),Object(we.jsxs)(re.a,{children:[Object(we.jsx)(ae.a,{onClick:function(){return at({open:!1})},children:0===rt.mode?"Reject":"Close"}),Object(we.jsx)("div",{style:{flexGrow:1}}),0===rt.mode&&Object(we.jsx)(ae.a,{onClick:function(){Nt=Object(A.a)(Object(A.a)({},Nt),{},Object(C.a)({},rt.uid,rt.key)),ln(),at({open:!1}),Zt.current&&Zt.current.uid===rt.uid&&Zt.current.act&&Zt.current.act()},children:"Accept"})]})]}),Object(we.jsx)(Ft,{open:wt,so:kt,cg:u,cl:w,sCl:k,d:At,rsk:bn,uid:Kt,sMeta:un}),Object(we.jsx)(ce.a,{open:ge.open,autoHideDuration:3e3,onClose:function(){return ve(Object(A.a)(Object(A.a)({},ge),{},{open:!1}))},children:Object(we.jsx)(ie.a,{onClose:function(){return ve(Object(A.a)(Object(A.a)({},ge),{},{open:!1}))},elevation:6,variant:"filled",severity:ge.type,sx:{width:"100%"},children:ge.msg})})]})}var Lt=n(306),Jt=n(127),zt=n(283),Gt=n(263),Ht=n(282),Vt=n(305),qt=n(125),Yt=Object(r.forwardRef)((function(e,t){var n=Object(r.useState)(!1),a=Object(d.a)(n,2),c=a[0],i=a[1];return Object(we.jsxs)(zt.a,{sx:Object(A.a)(Object(A.a)({},e.sx),{},{"&>div":{pb:0}}),variant:"filled",children:[Object(we.jsx)(Gt.a,{htmlFor:"pw",children:"Password"}),Object(we.jsx)(Ht.a,{label:"Password",sx:{width:"100%",pb:1},variant:"filled",ref:t,value:e.pw,onChange:function(t){return e.spw(t.target.value)},id:"pw",type:c?"text":"password",endAdornment:Object(we.jsx)(Vt.a,{position:"end",children:Object(we.jsx)(W.a,{"aria-label":"toggle password visibility",onClick:function(){return i(!c)},onMouseDown:function(e){return e.preventDefault()},edge:"end",children:c?Object(we.jsx)(wt.a,{}):Object(we.jsx)(qt.a,{})})}),autoComplete:"current-password"})]})})),Xt=n(126),$t=n.n(Xt),_t=function(e){for(var t=[],n=0;n<e;n++)t.push("".concat(3*(-.5+Math.random()),"em ").concat(3*(-.5+Math.random()),"em 8px hsla(").concat(360*Math.random(),",100%,50%,.9)"));return t.join(",")},Qt=100,Zt=Object(se.a)((function(e){return{container:{font:"5vmin/1.3 Serif",overflow:"hidden",background:"#123","&, &>div":{position:"absolute",top:0,left:0,bottom:0,right:0}},holders:{display:"block",fontSize:52,color:"transparent","&::before, &::after":{position:"fixed",top:"50%",left:"50%",width:"3em",height:"3em",content:'"."',mixBlendMode:"screen",animation:"56s -44s $move infinite ease-in-out alternate"}},holderA:{"&::before":{textShadow:_t(Qt),animationDuration:"108s",animationDelay:"-72s"},"&::after":{textShadow:_t(Qt),animationDuration:"102s",animationDelay:"-58.5s"}},holderB:{"&::before":{textShadow:_t(Qt),animationDuration:"96s",animationDelay:"-54s"},"&::after":{textShadow:_t(Qt),animationDuration:"84s",animationDelay:"-63s"}},"@keyframes move":{from:{transform:"rotate(0deg) scale(12) translateX(-20px)"},to:{transform:"rotate(360deg) scale(18) translateX(20px)"}}}}));function en(e){var t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!1),s=Object(d.a)(i,2),o=s[0],l=s[1],u=Object(r.useState)(""),b=Object(d.a)(u,2),j=b[0],h=b[1],x=Object(r.useRef)(),p=Zt();return"localhost"===window.location.hostname&&e.ss.unlock("Student01").then((function(t){console.log(t),t&&e.sl(!0)})),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsxs)("div",{className:p.container,children:[Object(we.jsx)("div",{className:Object(Be.a)([p.holders,p.holderA])}),Object(we.jsx)("div",{className:Object(Be.a)([p.holders,p.holderB])})]}),Object(we.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",left:0,top:0,zIndex:2,width:"100%"},children:Object(we.jsxs)(qe.a,{elevation:12,sx:{padding:2,minWidth:300,backgroundColor:"transparent",backdropFilter:"brightness(.3) saturate(2)"},children:[Object(we.jsx)(M.a,{variant:"h3",mb:.5,children:"Login"}),Object(we.jsx)(M.a,{gutterBottom:!0,children:"to Chatty"}),Object(we.jsx)($t.a,{duration:500,count:1,spy:a,children:Object(we.jsx)(Yt,{pw:j,spw:h,sx:{width:"100%",mt:.5},ref:x})}),Object(we.jsx)(Lt.a,{sx:{mb:1.5,visibility:o?"visible":"hidden"}}),Object(we.jsx)(ae.a,{variant:"contained",sx:{width:"100%"},endIcon:Object(we.jsx)(Jt.a,{}),disabled:o,onClick:function(){l(!0),e.ss.unlock(j).then((function(t){l(!1),t?e.sl(!0):(console.log(x.current),c((function(e){return!e})))}))},children:"Login"})]})})]})}var tn=n(307),nn=n(128),rn=n(129),an=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-512"}},!0,["encrypt","decrypt"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{pub:n,pri:r});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),cn=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-521"},!0,["sign","verify"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{signPri:r,signPub:n});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function sn(e){var t=e.ss,n=Object(r.useState)(null),a=Object(d.a)(n,2),c=a[0],i=a[1],s=Object(r.useState)({}),u=Object(d.a)(s,2),b=u[0],j=u[1],h=Object(r.useState)({}),x=Object(d.a)(h,2),p=x[0],O=x[1],m=Object(r.useState)(""),f=Object(d.a)(m,2),g=f[0],v=f[1],y=Object(r.useState)(!1),w=Object(d.a)(y,2),k=w[0],S=w[1];return Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("Generating keypair"),e.t0=j,e.next=4,an();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),i("Generating signing keys"),e.t2=O,e.next=10,cn();case 10:e.t3=e.sent,(0,e.t2)(e.t3),i(null);case 13:case"end":return e.stop()}}),e)})))()}),[]),Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(we.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(we.jsx)(M.a,{variant:"h3",gutterBottom:!0,children:"Welcome to Chatty"}),Object(we.jsx)(ae.a,{size:"large",variant:"contained",endIcon:Object(we.jsx)(nn.a,{}),onClick:function(){return S(!0)},children:"Get started"})]})}),Object(we.jsx)("div",{style:{position:"fixed",bottom:0,right:0,padding:8,display:"flex",alignItems:"center"},children:c?Object(we.jsxs)(we.Fragment,{children:[Object(we.jsx)(M.a,{variant:"subtitle1",color:"text.secondary",children:c}),Object(we.jsx)(tn.a,{size:30,sx:{ml:1}})]}):Object(we.jsx)(N.a,{title:"No tasks running",children:Object(we.jsx)(rn.a,{})})}),Object(we.jsxs)(Z.a,{open:k,onClose:function(){return S(!1)},maxWidth:"xs",fullWidth:!0,"aria-labelledby":"ob-d-t",children:[Object(we.jsx)(ee.a,{id:"ob-d-t",children:"Setup"}),Object(we.jsx)(te.a,{sx:{py:0},children:Object(we.jsxs)("div",{children:[Object(we.jsx)(M.a,{component:"span",color:"text.secondary",children:"Enter a password that will be used to encrypt local chat data"}),Object(we.jsx)(Yt,{pw:g,spw:v,sx:{width:"100%",mt:1}}),Object(we.jsx)(M.a,{variant:"subtitle2",component:"small",pt:.5,color:"text.secondary",children:"Please remember this password - It cannot be recovered if lost"})]})}),Object(we.jsx)(re.a,{children:Object(we.jsx)(ae.a,{onClick:Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(!1),i("Initialising datastore"),e.next=4,t.init(g);case 4:return i("Saving keypair"),e.next=7,t.setVal("priKey",b.pri);case 7:return e.next=9,t.setVal("pubKey",b.pub);case 9:return i("Saving signing keys"),e.next=12,t.setVal("signPub",p.signPub);case 12:return e.next=14,t.setVal("signPri",p.signPri);case 14:return i("Generating UID"),e.next=17,t.setVal("uid",Object(D.a)());case 17:i("Reloading..."),document.location.reload();case 19:case"end":return e.stop()}}),e)}))),variant:"contained",sx:{width:"100%"},children:"Done"})})]})]})}function on(){return Object(we.jsxs)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[Object(we.jsx)(tn.a,{}),Object(we.jsx)(M.a,{mt:1,children:"Loading"})]})}n(172),n(173),n(174);var ln=new y;var dn=function(){var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!1),i=Object(d.a)(c,2),s=i[0],u=i[1],j=Object(r.useState)(!0),h=Object(d.a)(j,2),x=h[0],p=h[1];return Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ln.isInit();case 2:t=e.sent,u(t),p(!1);case 5:case"end":return e.stop()}}),e)})))()}),[s]),Object(we.jsx)(we.Fragment,{children:Object(we.jsxs)(w.a,{theme:b("dark"),children:[Object(we.jsx)(k.a,{}),x?Object(we.jsx)(on,{}):s?n?Object(we.jsx)(Wt,{ss:ln}):Object(we.jsx)(en,{sl:a,ss:ln}):Object(we.jsx)(sn,{ss:ln})]})})},un=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,309)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(we.jsx)(a.a.StrictMode,{children:Object(we.jsx)(dn,{})}),document.getElementById("root")),un()}},[[175,1,2]]]);