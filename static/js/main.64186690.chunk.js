(this["webpackJsonpchatty2.0"]=this["webpackJsonpchatty2.0"]||[]).push([[0],{154:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(49),i=n.n(c),s=n(14),o=n.n(s),u=n(17),l=n(10),d=n(115);function b(e){"dark"!==e&&"light"!==e&&(e="dark");var t={shape:{borderRadius:7},palette:{mode:e,primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}},components:{MuiCssBaseline:{styleOverrides:"dark"===e?"/* ====== Custom scrollbar ======= */\n::-webkit-scrollbar {\n    background-color: #fff;\n    width: 14px\n}\n\n/* Background of the scrollbar except button or resizer */\n::-webkit-scrollbar-track {\n    background-color: #121212;\n}\n\n::-webkit-scrollbar-corner {\n    background-color: #121212;\n}\n\nbody.light ::-webkit-scrollbar-track, body.light ::-webkit-scrollbar-corner {\n    background-color: rgb(223, 223, 223);\n}\n\n/* scrollbar itself */\n::-webkit-scrollbar-thumb {\n    background-color: rgb(107, 107, 107);\n    border-radius: 14px;\n    border: 3px solid #121212;\n    transition: all 500ms ease-out;\n}\n::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(149, 149, 149);\n}\n\n.light *::-webkit-scrollbar-thumb {\n    background-color: rgb(150, 150, 150) !important;\n    border: 3px solid rgb(223, 223, 223) !important;\n}\n.light *::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(101, 101, 101) !important;\n}\n/* ============ */":""}}};return Object(d.a)(t)}var j=n(70),p=n(50),x=n(44),h=n.n(x);function O(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer}function f(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return btoa(t)}var g=function(){var e=Object(u.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),a=btoa(window.crypto.getRandomValues(new Uint8Array(12))),e.next=4,window.crypto.subtle.encrypt({name:"AES-GCM",iv:(new TextEncoder).encode(a)},n,r);case 4:return c=e.sent,i=new Uint8Array(c),s=f(i),e.abrupt("return",{data:s,iv:a});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),m=function(){var e=Object(u.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.data,a=(new TextEncoder).encode(t.iv),c=O(r),i={name:"AES-GCM",iv:a},e.next=7,window.crypto.subtle.decrypt(i,n,c);case 7:return s=e.sent,e.abrupt("return",(new TextDecoder).decode(s));case 11:return e.prev=11,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,n){return e.apply(this,arguments)}}(),v=n(29),y=function(){function e(){Object(j.a)(this,e),this.contents={}}return Object(p.a)(e,[{key:"isInit",value:function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getItem("iv");case 2:if(e.t1=e.sent,!e.t1){e.next=7;break}return e.next=6,h.a.getItem("salt");case 6:e.t1=e.sent;case 7:if(e.t0=e.t1,!e.t0){e.next=12;break}return e.next=11,h.a.getItem("data");case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"genKey",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getItem("salt");case 2:return n=e.sent,e.next=5,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 5:return r=e.sent,console.log(r),e.next=9,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:O(n),iterations:1e5,hash:"SHA-512"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);case 9:this.key=e.sent;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unlock",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.getItem("iv");case 2:return n=e.sent,e.next=5,this.genKey(t);case 5:return e.next=7,h.a.getItem("data");case 7:return r=e.sent,e.next=10,m({data:v.decompress(r),iv:v.decompress(n)},this.key);case 10:if(a=e.sent){e.next=13;break}return e.abrupt("return",!1);case 13:return this.contents=JSON.parse(v.decompressFromUTF16(a)),console.log(this.contents),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sync",value:function(){var e=Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(v.compressToUTF16(JSON.stringify(this.contents)),this.key);case 2:return t=e.sent,e.next=5,h.a.setItem("data",v.compress(t.data));case 5:return e.next=7,h.a.setItem("iv",v.compress(t.iv));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(u.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=f,e.next=3,window.crypto.getRandomValues(new Uint8Array(128));case 3:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.next=7,h.a.setItem("salt",n);case 7:return e.next=9,this.genKey(t);case 9:return e.next=11,this.sync();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setVal",value:function(){var e=Object(u.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.contents[t]=n,e.next=3,this.sync();case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVal",value:function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contents[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=n(247),k=n(207),C=n(5),S=n(18),A=n(23),E=n(214),I=n(209),D=n(231),T=n(232),K=n(217),R=n(233),P=n(230),F=n(210),J=n(225),N=n(234),V=n(85),U=n(235),H=n(224),G=n(236),B=n(208),L=n(223),M=n(218),W=n(116),q=n(237),z=n(238),Y=n(239),Z=n(240),Q=n(241),X=n(242),$=n(243),_=n(215),ee=n(212),te=n(103),ne=n.n(te),re=n(102),ae=n.n(re),ce=n(74),ie=n.n(ce),se=n(104),oe=n.n(se),ue=n(105),le=n.n(ue),de=n(106),be=n.n(de),je=n(108),pe=n.n(je),xe=n(107),he=n.n(xe),Oe=n(222),fe=n(95),ge=n.n(fe),me=n(94),ve=n.n(me),ye=n(1);function we(e){var t;return Object(ye.jsx)("div",{style:{flexGrow:1,padding:10,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:null!==(t=e.addChat)&&void 0!==t&&t?Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsx)(ve.a,{sx:{width:"30%",height:"30%"}}),Object(ye.jsx)(K.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"This space looks a little empty..."}),Object(ye.jsx)(K.a,{align:"center",children:"Click on the add button above to create your first chat"})]}):Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsx)(ge.a,{sx:{width:"30%",height:"30%"}}),Object(ye.jsx)(K.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"Click on a chat to begin chatting!"})]})})}var ke=Object(r.memo)(we);function Ce(e){var t=Object.keys(e.cl).filter((function(t){return e.cl[t].name.toLowerCase().includes(e.q.trim().toLowerCase())}));return Object(ye.jsx)(Oe.a,{sx:{width:"100%",p:0,overflowY:"auto"},children:0!==t.length?t.map((function(t){var n;return Object(ye.jsxs)(V.b,{button:!0,selected:e.cg===t,divider:!0,onClick:function(){return e.sg(t)},children:[Object(ye.jsx)(L.a,{children:Object(ye.jsx)(M.a,{children:Object(ye.jsx)(ie.a,{})})}),Object(ye.jsx)(H.a,{primary:null===(n=e.cl[t])||void 0===n?void 0:n.name,secondary:"Changhoa: Hm"})]},t)})):0===e.q.trim().length?Object(ye.jsx)(ke,{addChat:!0}):Object(ye.jsx)(V.b,{children:Object(ye.jsx)(H.a,{primary:"No results"})})})}var Se=Object(r.memo)(Ce),Ae=n(219),Ee=n(220),Ie=n(226),De=n(99),Te=n.n(De),Ke=n(100),Re=n.n(Ke),Pe=n(96),Fe=n.n(Pe),Je=n(97),Ne=n.n(Je),Ve=n(98),Ue=n.n(Ve);function He(e){var t=[{icon:Object(ye.jsx)(Fe.a,{}),name:"Photos & Videos"},{icon:Object(ye.jsx)(Ne.a,{}),name:"Camera"},{icon:Object(ye.jsx)(Ue.a,{}),name:"Document"}];return Object(ye.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",width:"100%"},children:[Object(ye.jsx)(Ae.a,{sx:{"&>button":{width:"46px",height:"46px"},position:"absolute",bottom:6,left:1},ariaLabel:"Add an attachment",icon:Object(ye.jsx)(Ee.a,{icon:Object(ye.jsx)(Te.a,{})}),children:t.map((function(e){return Object(ye.jsx)(Ie.a,{icon:e.icon,tooltipTitle:e.name},e.name)}))}),Object(ye.jsx)(F.a,{variant:"filled",multiline:!0,label:"Type a message",maxRows:5,onChange:function(t){return e.sm(t.target.value)},value:e.m,onKeyPress:function(t){"Enter"!==t.key||t.shiftKey||(e.send(),t.preventDefault())},sx:{flexGrow:1,mr:.5,ml:"58px"}}),Object(ye.jsx)(P.a,{color:"primary","aria-label":"send",sx:{mr:.5,mb:.5},onClick:e.send,children:Object(ye.jsx)(Re.a,{})})]})}var Ge=n(6),Be=Object(I.a)((function(e){return{msgBubble:{margin:"".concat(e.spacing(.5)," 0"),width:"fit-content",maxWidth:"80%",padding:"".concat(e.spacing(.5)," ").concat(e.spacing(1.25)),"&>p":{whiteSpace:"break-spaces",overflowWrap:"anywhere",marginTop:-4},"&>span":{fontWeight:900}},fromOther:{backgroundColor:"rgba(128, 128, 128,.3)",borderRadius:"0 12px 12px 12px"},fromUsr:{backgroundColor:"rgba(169,209,255,.3)",marginLeft:"auto",borderRadius:"12px 12px 0 12px"},usrJoint:{"&+div":{borderTopRightRadius:0}},otherJoint:{borderBottomLeftRadius:0},joint:{"&+div":{"&>p":{margin:0},"&>span":{display:"none"},marginTop:2},marginBottom:2}}}));function Le(e){var t,n=Be(),r=e.msg,a=e.uid,c=e.userUID,i=e.joined,s=a===c;return Object(ye.jsxs)("div",{className:Object(Ge.a)(n.msgBubble,(t={},Object(C.a)(t,n.usrJoint,i&&s),Object(C.a)(t,n.otherJoint,i&&!s),Object(C.a)(t,n.fromUsr,s),Object(C.a)(t,n.fromOther,!s),Object(C.a)(t,n.joint,i),t)),children:[Object(ye.jsx)(K.a,{variant:"caption",children:a}),Object(ye.jsx)(K.a,{children:r})]})}var Me=Object(r.memo)(Le);function We(e){return Object(ye.jsx)("div",{style:{minHeight:0,display:"flex",flex:"1 1 auto",justifyContent:"center",overflowY:"auto"},children:Object(ye.jsx)("div",{style:{minHeight:"100%",width:"100%",position:"relative"},children:Object(ye.jsx)("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",justifyContent:"flex-end",flexDirection:"column"},children:Object(ye.jsxs)("div",{style:{padding:"5px 42px",overflowY:"auto"},ref:e.sRef,children:[Object(ye.jsx)(K.a,{mb:1.5,color:"text.secondary",align:"center",children:"This is the beginning of the chat"}),e.c.map((function(t,n){var r;return Object(ye.jsx)(Me,{joined:(null===(r=e.c[n+1])||void 0===r?void 0:r.uid)===t.uid,userUID:e.uid,uid:t.uid,msg:t.msg},n)}))]})})})})}var qe=Object(r.memo)(We),ze=Object(I.a)((function(e){return{container:{minHeight:"calc(100vh - 64px)",display:"flex",alignItems:"stretch",padding:e.spacing(2)}}})),Ye={},Ze="",Qe={};function Xe(e){var t=ze(),n=e.ss,a=[{col:"#808080",label:"Connecting..."},{col:"#ff0000",label:"Error"},{col:"#00ff00",label:"Connected"},{col:"#ff8000",label:"Disconnected"}],c=Object(r.useState)(null),i=Object(l.a)(c,2),s=i[0],d=i[1],b=Object(r.useState)(null),j=Object(l.a)(b,2),p=j[0],x=j[1],h=Object(r.useState)({}),y=Object(l.a)(h,2),w=y[0],k=y[1],I=Object(r.useState)({open:!1,msg:"",type:"success"}),te=Object(l.a)(I,2),re=te[0],ce=te[1],se=Object(r.useState)(0),ue=Object(l.a)(se,2),de=ue[0],je=ue[1],xe=Object(r.useState)(""),Oe=Object(l.a)(xe,2),fe=Oe[0],ge=Oe[1],me=Object(r.useState)([]),ve=Object(l.a)(me,2),we=ve[0],Ce=ve[1],Ae=Object(r.useState)(!1),Ee=Object(l.a)(Ae,2),Ie=Ee[0],De=Ee[1],Te=Object(r.useState)(!1),Ke=Object(l.a)(Te,2),Re=Ke[0],Pe=Ke[1],Fe=Object(r.useState)(!1),Je=Object(l.a)(Fe,2),Ne=Je[0],Ve=Je[1],Ue=Object(r.useState)(""),Ge=Object(l.a)(Ue,2),Be=Ge[0],Le=Ge[1],Me=Object(r.useState)(""),We=Object(l.a)(Me,2),Xe=We[0],$e=We[1],_e=Object(r.useState)(0),et=Object(l.a)(_e,2),tt=et[0],nt=et[1],rt=Object(r.useState)({name:"",gid:""}),at=Object(l.a)(rt,2),ct=at[0],it=at[1],st=Object(r.useRef)({}),ot=Object(r.useRef)({}),ut=Object(r.useRef)({}),lt=Object(r.useRef)(),dt=Object(r.useRef)(null),bt=Object(r.useRef)(),jt=Object(r.useRef)({}),pt=Boolean(p),xt=function(){var e=Object(r.useRef)(!0);return Object(r.useEffect)((function(){e.current=!1}),[]),e.current}(),ht=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(Ye[s]=we),n.setVal("chatData",JSON.stringify(Ye)).then()};Object(r.useEffect)((function(){xt||(console.log("here"),n.setVal("chats",JSON.stringify(w)).then())}),[w]),Object(r.useEffect)((function(){0!==we.length&&0!==Object.keys(Ye).length&&ht()}),[we]),Object(r.useEffect)((function(){var e;Ce(null!==(e=Ye[s])&&void 0!==e?e:[]),gt(!1)}),[s]);var Ot=function(){var e=Object(u.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(lt&&1===lt.current.readyState){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,lt.current.send(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ft=function e(){lt.current=null,lt.current=new WebSocket("wss://chattyBackend.vinkwok.repl.co");var t=null,r=+new Date,a=function(){var e=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ot(JSON.stringify({act:"ping"}));case 2:r=+new Date;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();lt.current.onopen=Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==de){e.next=2;break}return e.abrupt("return");case 2:return je(2),e.next=5,Ot(JSON.stringify({uid:Ze}));case 5:return e.next=7,Ot(JSON.stringify({act:"updatePub",key:ot.current.pub}));case 7:return e.next=9,Ot(JSON.stringify({act:"updateSign",key:ut.current.pubSign}));case 9:return e.next=11,a();case 11:t=setInterval(a,3e3);case 12:case"end":return e.stop()}}),e)}))),lt.current.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(c){return}switch(console.log(t),t.resp){case"pong":nt(new Date-r);break;case"txtMsg":var a=function(){mt(t).then((function(e){var n={msg:e,uid:t.uid},r=null;d((function(e){return r=e,e})),Ye[t.gid]||(Ye[t.gid]=[]),t.gid===r?(Ce((function(e){return[].concat(Object(A.a)(e),[n])})),gt()):Ye[t.gid].push(n)}))};k((function(e){return e[t.gid]?(a(),e):(Ot(JSON.stringify({act:"getSignPub",target:t.uid})),jt.current={uid:t.uid,act:a},Object(S.a)(Object(S.a)({},e),{},Object(C.a)({},t.gid,{name:"Unknown chat",people:[t.uid]})))}));break;case"pubKey":st.current=Object(S.a)(Object(S.a)({},st.current),{},Object(C.a)({},t.uid,t.pub)),dt.current&&dt.current.uid===t.uid&&dt.current.act&&dt.current.act(t.pub);break;case"signKey":Qe||(Qe={}),Qe=Object(S.a)(Object(S.a)({},Qe),{},Object(C.a)({},t.uid,t.pub)),n.setVal("signKeys",Qe).then(),jt.current&&jt.current.uid===t.uid&&jt.current.act&&jt.current.act()}},lt.current.onclose=function(){je(3),clearInterval(t),setTimeout(e,5e3)},lt.current.onerror=function(){je(1)}};Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t,r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getVal("pubKey");case 2:return t=e.sent,e.next=5,n.getVal("priKey");case 5:return r=e.sent,ot.current={pub:t,pri:r},e.next=9,n.getVal("signPub");case 9:return a=e.sent,e.next=12,n.getVal("signPri");case 12:return c=e.sent,ut.current={pubSign:a,priSign:c},console.log(ut.current),e.next=17,n.getVal("signKeys");case 17:return Qe=e.sent,console.log(Qe),e.next=21,n.getVal("uid");case 21:return Ze=e.sent,e.next=24,n.getVal("chats");case 24:return i=e.sent,k(i?JSON.parse(i):{}),e.next=28,n.getVal("chatData");case 28:s=e.sent,Ye=s?JSON.parse(s):{},ft();case 31:case"end":return e.stop()}}),e)})))()}),[]);var gt=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];bt.current&&requestAnimationFrame((function(){return bt.current.scroll({top:bt.current.scrollHeight,left:0,behavior:e?"smooth":"auto"})}))},mt=function(){var e=Object(u.a)(o.a.mark((function e(t){var n,r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(Qe),e.next=3,window.crypto.subtle.importKey("jwk",ot.current.pri,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["decrypt"]);case 3:return n=e.sent,e.next=6,window.crypto.subtle.decrypt({name:"RSA-OAEP"},n,O(v.decompress(t.key)));case 6:return r=e.sent,e.next=9,window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt","decrypt"]);case 9:return a=e.sent,e.next=12,m({data:t.data,iv:v.decompress(t.iv)},a);case 12:if(c=e.sent,Qe&&Qe[t.uid]){e.next=15;break}return e.abrupt("return","The public keys required to verify this message are missing. Please recreate this chat.");case 15:return e.next=17,window.crypto.subtle.importKey("jwk",Qe[t.uid],{name:"ECDSA",namedCurve:"P-521"},!1,["verify"]);case 17:return i=e.sent,e.next=20,window.crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-512"}},i,O(v.decompress(t.sig)),(new TextEncoder).encode(JSON.stringify({data:t.data,iv:t.iv,gid:t.gid,id:t.target,key:t.key,act:"sendTxt"})));case 20:if(s=e.sent,console.log(s),s){e.next=24;break}return e.abrupt("return","Failed to verify authenticity of this message");case 24:return e.abrupt("return",v.decompressFromUTF16(c));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),vt=function(){var e=Object(u.a)(o.a.mark((function e(t,n){var r,a,c,i,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return r=e.sent,e.next=5,g(v.compressToUTF16(Be.trim()),r);case 5:return a=e.sent,c=a.data,i=a.iv,e.next=10,window.crypto.subtle.exportKey("raw",r);case 10:if(s=e.sent,l=function(){var e=Object(u.a)(o.a.mark((function e(r){var a,u,l,d,b;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",r,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["encrypt"]);case 2:return a=e.sent,e.next=5,window.crypto.subtle.encrypt({name:"RSA-OAEP"},a,s);case 5:return u=e.sent,l={data:c,iv:v.compress(i),gid:t,id:n,key:v.compress(f(u)),act:"sendTxt"},e.next=9,window.crypto.subtle.importKey("jwk",ut.current.priSign,{name:"ECDSA",namedCurve:"P-521"},!1,["sign"]);case 9:return d=e.sent,e.next=12,window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-512"}},d,(new TextEncoder).encode(JSON.stringify(l)));case 12:return b=e.sent,e.next=15,Ot(JSON.stringify(Object(S.a)(Object(S.a)({},l),{},{sig:v.compress(f(b))})));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),st.current[n]){e.next=18;break}return e.next=15,Ot(JSON.stringify({act:"getPub",uid:n}));case 15:dt.current={uid:n,act:l},e.next=20;break;case 18:return e.next=20,l(st.current[n]);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),yt=function(){De(!1),it({name:"",gid:""})},wt=function(){return Pe(!1)},kt=function(){return x(null)},Ct=function(){return Ve(!1)};return Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsxs)("div",{style:{minHeight:"100vh"},children:[Object(ye.jsx)(D.a,{position:"relative",children:Object(ye.jsxs)(T.a,{children:[Object(ye.jsx)(K.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Chatty"}),Object(ye.jsxs)(R.a,{sx:{padding:"4px 12px",display:"flex",alignItems:"center"},elevation:4,children:[Object(ye.jsx)("div",{style:{width:10,height:10,borderRadius:"50%",marginRight:"8px",backgroundColor:a[de].col}}),Object(ye.jsxs)(K.a,{variant:"subtitle1",children:[a[de].label," \u2022 RT: ",tt,"ms"]})]}),Object(ye.jsx)(P.a,{edge:"end",color:"inherit","aria-label":"lock",sx:{ml:1.5},onClick:function(){},children:Object(ye.jsx)(ae.a,{})})]})}),Object(ye.jsxs)("div",{className:t.container,children:[Object(ye.jsxs)(R.a,{sx:{width:400,mr:1,display:"grid",gridTemplateRows:"auto 1fr auto",maxHeight:"calc(100vh - 98px)"},elevation:6,children:[Object(ye.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",padding:"10px"},children:[Object(ye.jsx)(F.a,{variant:"outlined",label:"Search",value:fe,onChange:function(e){return ge(e.target.value)},sx:{flexGrow:1,mr:1}}),Object(ye.jsx)(J.a,{color:"secondary","aria-label":"add",size:"medium",onClick:function(){return De(!0)},children:Object(ye.jsx)(ne.a,{})})]}),Object(ye.jsx)(Se,{cl:w,sg:d,cg:s,q:fe}),Object(ye.jsx)(N.a,{}),Object(ye.jsxs)(V.b,{button:!0,ContainerComponent:"div",children:[Object(ye.jsx)(U.a,{children:Object(ye.jsx)(oe.a,{})}),Object(ye.jsx)(H.a,{primary:"Your Account"}),Object(ye.jsx)(G.a,{children:Object(ye.jsx)(B.a,{title:"Copy your UID",children:Object(ye.jsx)(P.a,{edge:"end","aria-label":"",sx:{mr:1e-4},onClick:function(){navigator.clipboard.writeText(Ze).then((function(){return ce({open:!0,msg:"Copied UID!",type:"success"})}))},children:Object(ye.jsx)(le.a,{})})})})]})]}),Object(ye.jsx)(R.a,{sx:{flexGrow:1,ml:1,position:"relative",display:"flex",flexDirection:"column"},elevation:6,children:s?Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsxs)(V.b,{button:!0,divider:!0,ContainerComponent:"div",children:[Object(ye.jsx)(L.a,{children:Object(ye.jsx)(M.a,{children:Object(ye.jsx)(ie.a,{})})}),Object(ye.jsx)(H.a,{primary:w[s].name,secondary:"Changhoa, Zerui & You"}),Object(ye.jsxs)(G.a,{children:[Object(ye.jsx)(P.a,{edge:"end","aria-label":"",id:"more-btn","aria-controls":"more-menu",onClick:function(e){return x(e.currentTarget)},sx:{mr:1e-4},children:Object(ye.jsx)(be.a,{})}),Object(ye.jsxs)(W.a,{id:"more-menu",sx:{"& .MuiSvgIcon-root":{color:"text.secondary",marginRight:1.5}},MenuListProps:{"aria-labelledby":"more-btn"},anchorEl:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:pt,onClose:kt,children:[Object(ye.jsxs)(q.a,{onClick:function(){Ve(!0),kt()},children:[Object(ye.jsx)(he.a,{}),"Edit Chat Title"]}),Object(ye.jsxs)(q.a,{onClick:function(){$e(w[s].name),Pe(!0),kt()},children:[Object(ye.jsx)(pe.a,{}),"Delete chat"]})]})]})]}),Object(ye.jsx)(qe,{c:we,sRef:bt,uid:Ze}),Object(ye.jsx)(He,{m:Be,sm:Le,send:function(){var e=Be.trim();0!==e.length&&(Ce([].concat(Object(A.a)(we),[{msg:e,uid:Ze}])),vt(s,w[s].people[0]).then((function(){Le("")})),gt())}})]}):Object(ye.jsx)(ke,{})})]})]}),Object(ye.jsxs)(z.a,{maxWidth:"xs",open:Ie,onClose:yt,"aria-labelledby":"ac-d-t","aria-describedby":"ac-d-d",children:[Object(ye.jsx)(Y.a,{id:"ac-d-t",children:"Add/Join a Chat"}),Object(ye.jsxs)(Z.a,{children:[Object(ye.jsx)(Q.a,{id:"ac-d-d",children:"Enter your recipient's UID here. This identifier does not need to be kept private."}),Object(ye.jsx)(F.a,{variant:"filled",sx:{width:"100%"},label:"Name",value:ct.name,onChange:function(e){return it(Object(S.a)(Object(S.a)({},ct),{},{name:e.target.value}))}}),Object(ye.jsx)(F.a,{sx:{width:"100%",mt:2,"&>div":{fontFamily:"Courier"}},label:"UID",variant:"outlined",onChange:function(e){return it(Object(S.a)(Object(S.a)({},ct),{},{gid:e.target.value}))},value:ct.gid})]}),Object(ye.jsxs)(X.a,{children:[Object(ye.jsx)($.a,{onClick:yt,children:"Close"}),Object(ye.jsx)($.a,{onClick:function(){k(Object(S.a)(Object(S.a)({},w),{},Object(C.a)({},Object(E.a)(),{name:ct.name,people:[ct.gid]}))),Ot(JSON.stringify({act:"getSignPub",target:ct.gid})),yt()},children:"Add"})]})]}),Object(ye.jsxs)(z.a,{maxWidth:"xs",open:Re,onClose:wt,"aria-labelledby":"cd-d-t","aria-describedby":"cd-d-d",children:[Object(ye.jsx)(Y.a,{id:"cd-d-t",children:"Delete chat?"}),Object(ye.jsx)(Z.a,{children:Object(ye.jsx)(Q.a,{mb:"0!important",children:"All messages will be deleted. This action cannot be undone."})}),Object(ye.jsxs)(X.a,{children:[Object(ye.jsx)($.a,{onClick:wt,children:"Cancel"}),Object(ye.jsx)("div",{style:{flexGrow:1}}),Object(ye.jsx)($.a,{onClick:function(){var e=s;d(null),k((function(t){var n=Object(S.a)({},t);return delete n[e],n})),Ce([]),requestAnimationFrame((function(){delete Ye[e],console.log(Ye),ht(!0)})),wt()},children:"Delete"})]})]}),Object(ye.jsxs)(z.a,{maxWidth:"xs",open:Ne,onClose:Ct,"aria-labelledby":"ct-d-t","aria-describedby":"ct-d-d",children:[Object(ye.jsx)(Y.a,{id:"ct-d-t",children:"Edit Chat Title"}),Object(ye.jsxs)(Z.a,{children:[Object(ye.jsx)(Q.a,{children:"Enter a new title for this chat below. It does not need to be unique."}),Object(ye.jsx)(F.a,{variant:"filled",value:Xe,onChange:function(e){return $e(e.target.value)},label:"New Chat Title",sx:{width:"100%"}})]}),Object(ye.jsxs)(X.a,{children:[Object(ye.jsx)($.a,{onClick:Ct,children:"Cancel"}),Object(ye.jsx)($.a,{onClick:function(){k((function(e){var t=Object(S.a)({},e);return t[s].name=Xe,t})),Ct()},children:"Change Title"})]})]}),Object(ye.jsx)(_.a,{open:re.open,autoHideDuration:3e3,onClose:function(){return ce(Object(S.a)(Object(S.a)({},re),{},{open:!1}))},children:Object(ye.jsx)(ee.a,{onClose:function(){return ce(Object(S.a)(Object(S.a)({},re),{},{open:!1}))},elevation:6,variant:"filled",severity:re.type,sx:{width:"100%"},children:re.msg})})]})}var $e=n(245),_e=n(112),et=n.n(_e),tt=n(228),nt=n(216),rt=n(227),at=n(244),ct=n(109),it=n.n(ct),st=n(110),ot=n.n(st),ut=Object(r.forwardRef)((function(e,t){var n=Object(r.useState)(!1),a=Object(l.a)(n,2),c=a[0],i=a[1];return Object(ye.jsxs)(tt.a,{sx:Object(S.a)(Object(S.a)({},e.sx),{},{"&>div":{pb:0}}),variant:"filled",children:[Object(ye.jsx)(nt.a,{htmlFor:"pw",children:"Password"}),Object(ye.jsx)(rt.a,{label:"Password",sx:{width:"100%",pb:1},variant:"filled",ref:t,value:e.pw,onChange:function(t){return e.spw(t.target.value)},id:"pw",type:c?"text":"password",endAdornment:Object(ye.jsx)(at.a,{position:"end",children:Object(ye.jsx)(P.a,{"aria-label":"toggle password visibility",onClick:function(){return i(!c)},onMouseDown:function(e){return e.preventDefault()},edge:"end",children:c?Object(ye.jsx)(it.a,{}):Object(ye.jsx)(ot.a,{})})}),autoComplete:"current-password"})]})})),lt=n(111),dt=n.n(lt);function bt(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!1),s=Object(l.a)(i,2),o=s[0],u=s[1],d=Object(r.useState)(""),b=Object(l.a)(d,2),j=b[0],p=b[1],x=Object(r.useRef)();return Object(ye.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(ye.jsxs)(R.a,{elevation:12,sx:{padding:2,minWidth:300},children:[Object(ye.jsx)(K.a,{variant:"h3",mb:.5,children:"Login"}),Object(ye.jsx)(K.a,{gutterBottom:!0,children:"to Chatty"}),Object(ye.jsx)(dt.a,{duration:500,count:1,spy:a,children:Object(ye.jsx)(ut,{pw:j,spw:p,sx:{width:"100%",mt:.5},ref:x})}),Object(ye.jsx)($e.a,{sx:{mb:1.5,visibility:o?"visible":"hidden"}}),Object(ye.jsx)($.a,{variant:"contained",sx:{width:"100%"},endIcon:Object(ye.jsx)(et.a,{}),disabled:o,onClick:function(){u(!0),e.ss.unlock(j).then((function(t){u(!1),t?e.sl(!0):(console.log(x.current),c((function(e){return!e})))}))},children:"Login"})]})})}var jt=n(246),pt=n(113),xt=n.n(pt),ht=n(114),Ot=n.n(ht),ft=function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-512"}},!0,["encrypt","decrypt"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{pub:n,pri:r});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gt=function(){var e=Object(u.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-521"},!0,["sign","verify"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{signPri:r,signPub:n});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function mt(e){var t=e.ss,n=Object(r.useState)(null),a=Object(l.a)(n,2),c=a[0],i=a[1],s=Object(r.useState)({}),d=Object(l.a)(s,2),b=d[0],j=d[1],p=Object(r.useState)({}),x=Object(l.a)(p,2),h=x[0],O=x[1],f=Object(r.useState)(""),g=Object(l.a)(f,2),m=g[0],v=g[1],y=Object(r.useState)(!1),w=Object(l.a)(y,2),k=w[0],C=w[1];return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("Generating keypair"),e.t0=j,e.next=4,ft();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),i("Generating signing keys"),e.t2=O,e.next=10,gt();case 10:e.t3=e.sent,(0,e.t2)(e.t3),i(null);case 13:case"end":return e.stop()}}),e)})))()}),[]),Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(ye.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(ye.jsx)(K.a,{variant:"h3",gutterBottom:!0,children:"Welcome to Chatty"}),Object(ye.jsx)($.a,{size:"large",variant:"contained",endIcon:Object(ye.jsx)(xt.a,{}),onClick:function(){return C(!0)},children:"Get started"})]})}),Object(ye.jsx)("div",{style:{position:"fixed",bottom:0,right:0,padding:8,display:"flex",alignItems:"center"},children:c?Object(ye.jsxs)(ye.Fragment,{children:[Object(ye.jsx)(K.a,{variant:"subtitle1",color:"text.secondary",children:c}),Object(ye.jsx)(jt.a,{size:30,sx:{ml:1}})]}):Object(ye.jsx)(B.a,{title:"No tasks running",children:Object(ye.jsx)(Ot.a,{})})}),Object(ye.jsxs)(z.a,{open:k,onClose:function(){return C(!1)},maxWidth:"xs",fullWidth:!0,"aria-labelledby":"ob-d-t",children:[Object(ye.jsx)(Y.a,{id:"ob-d-t",children:"Setup"}),Object(ye.jsx)(Z.a,{sx:{py:0},children:Object(ye.jsxs)("div",{children:[Object(ye.jsx)(K.a,{component:"span",color:"text.secondary",children:"Enter a password that will be used to encrypt local chat data"}),Object(ye.jsx)(ut,{pw:m,spw:v,sx:{width:"100%",mt:1}}),Object(ye.jsx)(K.a,{variant:"subtitle2",component:"small",pt:.5,color:"text.secondary",children:"Please remember this password - It cannot be recovered if lost"})]})}),Object(ye.jsx)(X.a,{children:Object(ye.jsx)($.a,{onClick:Object(u.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!1),i("Initialising datastore"),e.next=4,t.init(m);case 4:return i("Saving keypair"),e.next=7,t.setVal("priKey",b.pri);case 7:return e.next=9,t.setVal("pubKey",b.pub);case 9:return i("Saving signing keys"),e.next=12,t.setVal("signPub",h.signPub);case 12:return e.next=14,t.setVal("signPri",h.signPri);case 14:return i("Generating UID"),e.next=17,t.setVal("uid",Object(E.a)());case 17:i("Reloading..."),document.location.reload();case 19:case"end":return e.stop()}}),e)}))),variant:"contained",sx:{width:"100%"},children:"Done"})})]})]})}function vt(){return Object(ye.jsxs)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[Object(ye.jsx)(jt.a,{}),Object(ye.jsx)(K.a,{mt:1,children:"Loading"})]})}var yt=new y;var wt=function(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!1),i=Object(l.a)(c,2),s=i[0],d=i[1],j=Object(r.useState)(!0),p=Object(l.a)(j,2),x=p[0],h=p[1];return Object(r.useEffect)((function(){Object(u.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt.isInit();case 2:t=e.sent,d(t),h(!1);case 5:case"end":return e.stop()}}),e)})))()}),[s]),Object(ye.jsx)(ye.Fragment,{children:Object(ye.jsxs)(w.a,{theme:b("dark"),children:[Object(ye.jsx)(k.a,{}),x?Object(ye.jsx)(vt,{}):s?n?Object(ye.jsx)(Xe,{ss:yt}):Object(ye.jsx)(bt,{sl:a,ss:yt}):Object(ye.jsx)(mt,{ss:yt})]})})},kt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,248)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(ye.jsx)(a.a.StrictMode,{children:Object(ye.jsx)(wt,{})}),document.getElementById("root")),kt()}},[[154,1,2]]]);