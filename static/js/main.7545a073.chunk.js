(this["webpackJsonpchatty2.0"]=this["webpackJsonpchatty2.0"]||[]).push([[0],{160:function(e,t,n){},176:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(50),i=n.n(c),s=n(14),o=n.n(s),l=n(18),u=n(10),d=(n(160),n(134));function b(e){"dark"!==e&&"light"!==e&&(e="dark");var t={shape:{borderRadius:7},palette:{mode:e,primary:{main:"#1976d2"},secondary:{main:"#9c27b0"}},typography:{fontFamily:["Poppins","Roboto","-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"','"Segoe UI Symbol"'].join(",")},components:{MuiCssBaseline:{styleOverrides:"dark"===e?"/* ====== Custom scrollbar ======= */\n::-webkit-scrollbar {\n    background-color: #fff;\n    width: 14px\n}\n\n/* Background of the scrollbar except button or resizer */\n::-webkit-scrollbar-track {\n    background-color: #2c2c2c;\n}\n\n::-webkit-scrollbar-corner {\n    background-color: #2c2c2c;\n}\n\nbody.light ::-webkit-scrollbar-track, body.light ::-webkit-scrollbar-corner {\n    background-color: rgb(223, 223, 223);\n}\n\n/* scrollbar itself */\n::-webkit-scrollbar-thumb {\n    background-color: rgb(107, 107, 107);\n    border-radius: 14px;\n    border: 3px solid #2c2c2c;\n    transition: all 500ms ease-out;\n}\n::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(149, 149, 149);\n}\n\n.light *::-webkit-scrollbar-thumb {\n    background-color: rgb(150, 150, 150) !important;\n    border: 3px solid rgb(223, 223, 223) !important;\n}\n.light *::-webkit-scrollbar-thumb:hover {\n    background-color: rgb(101, 101, 101) !important;\n}\n/* ============ */":""}}};return Object(d.a)(t)}var j=n(77),x=n(51),h=n(48),p=n.n(h);function O(e){for(var t=window.atob(e),n=t.length,r=new Uint8Array(n),a=0;a<n;a++)r[a]=t.charCodeAt(a);return r.buffer}function m(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,a=0;a<r;a++)t+=String.fromCharCode(n[a]);return btoa(t)}var f=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(new TextEncoder).encode(t),a=btoa(window.crypto.getRandomValues(new Uint8Array(12))),e.next=4,window.crypto.subtle.encrypt({name:"AES-GCM",iv:(new TextEncoder).encode(a)},n,r);case 4:return c=e.sent,i=new Uint8Array(c),s=m(i),e.abrupt("return",{data:s,iv:a});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),g=function(){var e=Object(l.a)(o.a.mark((function e(t,n){var r,a,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.data,a=(new TextEncoder).encode(t.iv),c=O(r),i={name:"AES-GCM",iv:a},console.log("here"),e.next=8,window.crypto.subtle.decrypt(i,n,c);case 8:return s=e.sent,console.log("ok"),e.abrupt("return",(new TextDecoder).decode(s));case 13:return e.prev=13,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t,n){return e.apply(this,arguments)}}(),y=n(29),v=function(){function e(){Object(j.a)(this,e),this.contents={}}return Object(x.a)(e,[{key:"isInit",value:function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("iv");case 2:if(e.t1=e.sent,!e.t1){e.next=7;break}return e.next=6,p.a.getItem("salt");case 6:e.t1=e.sent;case 7:if(e.t0=e.t1,!e.t0){e.next=12;break}return e.next=11,p.a.getItem("data");case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"genKey",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("salt");case 2:return n=e.sent,e.next=5,window.crypto.subtle.importKey("raw",(new TextEncoder).encode(t),{name:"PBKDF2"},!1,["deriveKey"]);case 5:return r=e.sent,console.log(r),e.next=9,window.crypto.subtle.deriveKey({name:"PBKDF2",salt:O(n),iterations:1e5,hash:"SHA-512"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]);case 9:this.key=e.sent;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unlock",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getItem("iv");case 2:return n=e.sent,e.next=5,this.genKey(t);case 5:return e.next=7,p.a.getItem("data");case 7:return r=e.sent,e.next=10,g({data:y.decompress(r),iv:y.decompress(n)},this.key);case 10:if(a=e.sent){e.next=13;break}return e.abrupt("return",!1);case 13:return this.contents=JSON.parse(y.decompressFromUTF16(a)),console.log(this.contents),e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sync",value:function(){var e=Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(y.compressToUTF16(JSON.stringify(this.contents)),this.key);case 2:return t=e.sent,e.next=5,p.a.setItem("data",y.compress(t.data));case 5:return e.next=7,p.a.setItem("iv",y.compress(t.iv));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(l.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,window.crypto.getRandomValues(new Uint8Array(128));case 3:return e.t1=e.sent,n=(0,e.t0)(e.t1),e.next=7,p.a.setItem("salt",n);case 7:return e.next=9,this.genKey(t);case 9:return e.next=11,this.sync();case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setVal",value:function(){var e=Object(l.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.contents[t]=n,e.next=3,this.sync();case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getVal",value:function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contents[t]);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),w=n(291),k=n(244),C=n(4),S=n(17),P=n(26),A=n(253),T=n(247),I=n(275),E=n(276),R=n(262),D=n(282),F=n(272),K=n(248),U=n(266),N=n(279),B=n(94),J=n(273),M=n(265),V=n(281),G=n(246),W=n(135),H=n(283),z=n(264),L=n(258),Y=n(274),q=n(284),X=n(285),_=n(286),Q=n(287),Z=n(278),$=n(254),ee=n(251),te=n(122),ne=n.n(te),re=n(69),ae=n.n(re),ce=n(80),ie=n.n(ce),se=n(123),oe=n.n(se),le=n(124),ue=n.n(le),de=n(126),be=n.n(de),je=n(128),xe=n.n(je),he=n(127),pe=n.n(he),Oe=n.p+"static/media/icon.7a29522d.svg",me=n(81),fe=n.n(me),ge=n(68),ye=n.n(ge),ve=n(125),we=n.n(ve),ke=n(263),Ce=n(107),Se=n.n(Ce),Pe=n(106),Ae=n.n(Pe),Te=n(0);function Ie(e){var t;return Object(Te.jsx)("div",{style:{flexGrow:1,padding:10,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:null!==(t=e.addChat)&&void 0!==t&&t?Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(Ae.a,{sx:{width:"30%",height:"30%"}}),Object(Te.jsx)(R.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"This space looks a little empty..."}),Object(Te.jsx)(R.a,{align:"center",children:"Click on the add button above to create your first chat"})]}):Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(Se.a,{sx:{width:"30%",height:"30%"}}),Object(Te.jsx)(R.a,{variant:"h4",p:2,align:"center",color:"text.secondary",children:"Click on a chat to begin chatting!"})]})})}var Ee=Object(r.memo)(Ie);function Re(e){var t=Object.keys(e.cl).filter((function(t){return e.cl[t].name.toLowerCase().includes(e.q.trim().toLowerCase())}));return Object(Te.jsx)(ke.a,{sx:{width:"100%",p:0,overflowY:"auto"},children:0!==t.length?t.map((function(t){var n;return Object(Te.jsxs)(B.b,{button:!0,selected:e.cg===t,divider:!0,onClick:function(){return e.sg(t)},children:[Object(Te.jsx)(z.a,{children:Object(Te.jsx)(L.a,{children:Object(Te.jsx)(ie.a,{})})}),Object(Te.jsx)(M.a,{primary:null===(n=e.cl[t])||void 0===n?void 0:n.name,secondary:"Changhoa: Hm"})]},t)})):0===e.q.trim().length?Object(Te.jsx)(Ee,{addChat:!0}):Object(Te.jsx)(B.b,{children:Object(Te.jsx)(M.a,{primary:"No results"})})})}var De=Object(r.memo)(Re),Fe=n(259),Ke=n(260),Ue=n(267),Ne=n(111),Be=n.n(Ne),Je=n(112),Me=n.n(Je),Ve=n(108),Ge=n.n(Ve),We=n(109),He=n.n(We),ze=n(110),Le=n.n(ze);function Ye(e){var t=[{icon:Object(Te.jsx)(Ge.a,{}),name:"Photos & Videos"},{icon:Object(Te.jsx)(He.a,{}),name:"Camera"},{icon:Object(Te.jsx)(Le.a,{}),name:"Document"}];return Object(Te.jsxs)("div",{style:{display:"flex",alignItems:"flex-end",width:"100%"},children:[Object(Te.jsx)(Fe.a,{sx:{"&>button":{width:"46px",height:"46px"},position:"absolute",bottom:6,left:1},ariaLabel:"Add an attachment",icon:Object(Te.jsx)(Ke.a,{icon:Object(Te.jsx)(Be.a,{})}),children:t.map((function(e){return Object(Te.jsx)(Ue.a,{icon:e.icon,tooltipTitle:e.name},e.name)}))}),Object(Te.jsx)(K.a,{variant:"filled",multiline:!0,label:"Type a message",maxRows:5,onChange:function(t){return e.sm(t.target.value)},value:e.m,onKeyPress:function(t){"Enter"!==t.key||t.shiftKey||(e.send(),t.preventDefault())},inputProps:{maxLength:1e3},sx:{flexGrow:1,mr:.5,ml:"58px"}}),Object(Te.jsx)(F.a,{color:"primary","aria-label":"send",sx:{mr:.5,mb:.5},onClick:e.send,children:Object(Te.jsx)(Me.a,{})})]})}var qe=n(6),Xe=n(256),_e=n(270),Qe=n(242),Ze=n(5),$e=n(116),et=n.n($e),tt=n(115),nt=n.n(tt),rt=n(113),at=n.n(rt),ct=Object(T.a)((function(e){return{msgBubble:{width:"fit-content",maxWidth:"80%",padding:"".concat(e.spacing(.6)," ").concat(e.spacing(1.4)),boxShadow:e.shadows[3],overflow:"hidden","&>p":{whiteSpace:"break-spaces",overflowWrap:"anywhere",marginTop:-4,"& a":{color:e.palette.primary.main}},"&>span":{fontWeight:900}},holder:{width:"100%",padding:"".concat(e.spacing(.25)," 0"),display:"flex",position:"relative"},fromOther:{backgroundColor:"rgba(128, 128, 128,.2)",borderRadius:"0 12px 12px 12px",marginLeft:72},fromUsr:{backgroundColor:"rgba(144,202,255,0.2)",marginLeft:"auto",marginRight:72,borderRadius:"12px 12px 0 12px"},usrJoint:{borderTopRightRadius:0},otherJoint:{borderBottomLeftRadius:0},nextJoint:{"&>span":{display:"none"},paddingTop:8},noPadding:{paddingTop:0},first:{paddingTop:e.spacing(1)},last:{paddingBottom:e.spacing(1)}}}));function it(e){var t=["primary.light","primary.main","primary.dark","secondary.light","secondary.main","secondary.dark"];return{sx:{bgcolor:t[Math.floor(Math.random()*t.length)]},children:Object(Te.jsx)(ye.a,{})}}var st=Object(Ze.a)(Xe.a)((function(e){var t=e.theme;return{"& .MuiBadge-badge":{backgroundColor:"#44b700",color:"#44b700",boxShadow:"0 0 0 2px ".concat(t.palette.background.paper),"&::after":{position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"50%",border:"1px solid currentColor",content:'""'}},"&:active":{transform:"translateY(2px)"}}})),ot=function(e){var t=Object(r.useState)(null),n=Object(u.a)(t,2),a=n[0],c=n[1],i=Boolean(a);return Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(G.a,{title:"Online",children:Object(Te.jsx)(st,{sx:Object(C.a)({position:"absolute"},e.fromUsr?"right":"left",16),anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",variant:"dot",onClick:function(e){return c(e.currentTarget)},children:Object(Te.jsx)(L.a,Object(S.a)({},it(e.uid)))})}),Object(Te.jsxs)(_e.a,{open:i,anchorEl:a,onClose:function(){return c(null)},PaperProps:{style:{width:250,transform:"translateX(".concat(e.fromUsr?-16:16,"px)")}},anchorOrigin:{vertical:"center",horizontal:e.fromUsr?"left":"right"},transformOrigin:{vertical:"center",horizontal:e.fromUsr?"right":"left"},children:[Object(Te.jsxs)(Qe.a,{sx:{bgcolor:"background.paper",overflow:"hidden",display:"flex",flexDirection:"column"},children:[Object(Te.jsx)(G.a,{title:"Online",children:Object(Te.jsx)(Xe.a,{sx:{m:"16px auto"},badgeContent:" ",color:"success",anchorOrigin:{vertical:"bottom",horizontal:"right"},overlap:"circular",children:Object(Te.jsx)(L.a,{sx:{width:80,height:80}})})}),Object(Te.jsx)(R.a,{align:"center",children:e.uid}),Object(Te.jsx)(R.a,{align:"center",variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"User status goes here"})]}),Object(Te.jsx)(K.a,{label:"Note",variant:"filled",sx:{m:1,width:"calc(100% - 16px)"}}),Object(Te.jsxs)(ke.a,{sx:{p:0},dense:!0,children:[Object(Te.jsxs)(B.b,{button:!0,children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(ye.a,{})}),Object(Te.jsx)(M.a,{children:"View Profile"})]}),Object(Te.jsxs)(B.b,{button:!0,children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(nt.a,{})}),Object(Te.jsx)(M.a,{children:"Edit Info"})]}),Object(Te.jsxs)(B.b,{button:!0,children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(fe.a,{})}),Object(Te.jsx)(M.a,{children:"Verify Signing Key"})]}),Object(Te.jsxs)(B.b,{button:!0,children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(et.a,{})}),Object(Te.jsx)(M.a,{children:"Block"})]})]})]})]})};function lt(e){var t,n;console.log(e);var r=ct(),a=e.msg,c=e.uid,i=e.userUID,s=e.prevJoint,o=e.nextJoint,l=e.first,u=e.last,d=c===i;return Object(Te.jsxs)("div",{className:Object(qe.a)(r.holder,(t={},Object(C.a)(t,r.noPadding,o),Object(C.a)(t,r.first,l),Object(C.a)(t,r.last,u),t)),children:[Object(Te.jsxs)("div",{className:Object(qe.a)(r.msgBubble,(n={},Object(C.a)(n,r.usrJoint,d&&o),Object(C.a)(n,r.otherJoint,!d&&s),Object(C.a)(n,r.fromUsr,d),Object(C.a)(n,r.fromOther,!d),Object(C.a)(n,r.nextJoint,o),n)),children:[Object(Te.jsx)(R.a,{variant:"caption",color:"text.secondary",children:c}),Object(Te.jsx)(R.a,{children:Object(Te.jsx)(at.a,{options:{defaultProtocol:"https",target:{url:"_blank"}},children:a})})]}),!o&&Object(Te.jsx)(ot,{uid:c,fromUsr:d})]})}var ut=Object(r.memo)(lt),dt=n(136);function bt(e){return Object(Te.jsx)("div",{style:{minHeight:0,display:"flex",flex:"1 1 auto",justifyContent:"center",overflowY:"auto"},children:Object(Te.jsx)("div",{style:{minHeight:"100%",width:"100%",position:"relative"},children:Object(Te.jsx)(dt.a,{style:{padding:"10px 0"},initialTopMostItemIndex:e.c.length,ref:e.r,overscan:250,alignToBottom:!0,followOutput:function(){return"auto"},totalCount:e.c.length,itemContent:function(t){var n,r,a,c,i,s;return Object(Te.jsx)(ut,{prevJoint:(null===(n=e.c[t+1])||void 0===n?void 0:n.uid.trim())===(null===(r=e.c[t])||void 0===r?void 0:r.uid.trim()),first:0===t,nextJoint:(null===(a=e.c[t-1])||void 0===a?void 0:a.uid.trim())===(null===(c=e.c[t])||void 0===c?void 0:c.uid.trim()),last:t===e.c.length-1,userUID:e.uid,uid:null===(i=e.c[t])||void 0===i?void 0:i.uid,msg:null===(s=e.c[t])||void 0===s?void 0:s.msg},t)}})})})}var jt=Object(r.memo)(bt);function xt(e){return ht.apply(this,arguments)}function ht(){return(ht=Object(l.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(new TextEncoder).encode(t),e.next=3,crypto.subtle.digest("SHA-256",n);case 3:return r=e.sent,a=Array.from(new Uint8Array(r)),e.abrupt("return",a.map((function(e){return e.toString(16).padStart(2,"0")})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pt=function(){var e=Object(l.a)(o.a.mark((function e(t,n,r){var a,c,i,s,l;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",n.current.pri,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["decrypt"]);case 2:return a=e.sent,e.next=5,window.crypto.subtle.decrypt({name:"RSA-OAEP"},a,O(y.decompressFromUTF16(t.key)));case 5:return c=e.sent,e.next=8,window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt","decrypt"]);case 8:return i=e.sent,e.next=11,g({data:t.data,iv:y.decompressFromUTF16(t.iv)},i);case 11:if(s=e.sent,r&&r[t.uid]){e.next=14;break}return e.abrupt("return","The public keys required to verify this message are missing. Please recreate this chat.");case 14:return e.next=16,window.crypto.subtle.importKey("jwk",r[t.uid],{name:"ECDSA",namedCurve:"P-521"},!1,["verify"]);case 16:return l=e.sent,e.next=19,window.crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-512"}},l,O(y.decompressFromUTF16(t.sig)),(new TextEncoder).encode(JSON.stringify({data:t.data,iv:t.iv,gid:t.gid,id:t.target,key:t.key,act:"sendTxt"})));case 19:if(e.sent){e.next=22;break}return e.abrupt("return","Failed to verify authenticity of this message");case 22:return e.abrupt("return",y.decompressFromUTF16(s));case 23:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ot=function(){var e=Object(l.a)(o.a.mark((function e(t,n,r,a,c,i,s){var u,d,b,j,x,h;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);case 2:return u=e.sent,e.next=5,f(y.compressToUTF16(r.trim()),u);case 5:return d=e.sent,b=d.data,j=d.iv,e.next=10,window.crypto.subtle.exportKey("raw",u);case 10:if(x=e.sent,h=function(){var e=Object(l.a)(o.a.mark((function e(r){var c,i,l,u,d;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.importKey("jwk",r,{name:"RSA-OAEP",hash:{name:"SHA-512"}},!1,["encrypt"]);case 2:return c=e.sent,e.next=5,window.crypto.subtle.encrypt({name:"RSA-OAEP"},c,x);case 5:return i=e.sent,l={data:b,iv:y.compressToUTF16(j),gid:t,id:n,key:y.compressToUTF16(m(i)),act:"sendTxt"},e.next=9,window.crypto.subtle.importKey("jwk",a.current.priSign,{name:"ECDSA",namedCurve:"P-521"},!1,["sign"]);case 9:return u=e.sent,e.next=12,window.crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-512"}},u,(new TextEncoder).encode(JSON.stringify(l)));case 12:return d=e.sent,e.next=15,s(JSON.stringify(Object(S.a)(Object(S.a)({},l),{},{sig:y.compressToUTF16(m(d))})));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.current[n]){e.next=18;break}return e.next=15,s(JSON.stringify({act:"getPub",uid:n}));case 15:i.current={uid:n,act:h},e.next=20;break;case 18:return e.next=20,h(c.current[n]);case 20:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c,i,s){return e.apply(this,arguments)}}(),mt=n(118),ft=n(243),gt=n(257),yt=n(271),vt=n(249),wt=n(277),kt=n(280),Ct=n(84),St=n.n(Ct),Pt=n(120),At=n.n(Pt),Tt=n(82),It=n.n(Tt),Et=n(119),Rt=n.n(Et),Dt=n(121),Ft=n.n(Dt),Kt=n(245),Ut=r.forwardRef((function(e,t){return Object(Te.jsx)(ft.a,Object(S.a)({direction:"up",ref:t},e))}));function Nt(e){var t=e.children,n=e.value,r=e.index,a=Object(mt.a)(e,["children","value","index"]);return Object(Te.jsx)("div",Object(S.a)(Object(S.a)({role:"tabpanel",hidden:n!==r},a),{},{children:n===r&&Object(Te.jsx)(Qe.a,{sx:{p:1.5},children:t})}))}function Bt(e){var t,n,a,c,i=e.d,s=[{icon:Object(Te.jsx)(It.a,{}),title:"Overview"},{icon:Object(Te.jsx)(ae.a,{}),title:"Security"},{icon:Object(Te.jsx)(Rt.a,{}),title:"Roles"}],o=Object(r.useState)(0),l=Object(u.a)(o,2),d=l[0],b=l[1],j=Object(r.useState)({}),x=Object(u.a)(j,2),h=x[0],p=x[1],O=Object(r.useState)({}),m=Object(u.a)(O,2),f=m[0],g=m[1],y=Object(r.useState)([{name:"Owner",color:"#fbc02d"},{name:"Wang",color:"#1e88e5"},{name:"Lol",color:"#ef5350"},{name:"Testers",color:"#ab47bc"},{name:"Die-no",color:"#4caf50"},{name:"A very long role that will be truncated",color:"#26a69a"},{name:"Lower roles have less priority",color:"#78909c"}]),v=Object(u.a)(y,2),w=v[0],A=(v[1],Object(r.useState)(0)),T=Object(u.a)(A,2),D=T[0],U=T[1],G=Object(r.useState)("appear"),W=Object(u.a)(G,2),H=W[0],q=W[1],X=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){var r,a;if(n?(r=f,a=g):(r=h,a=p),r[t]){var c=r[t].indexOf(e),i=Object(P.a)(r[t]);-1===c?i.push(e):i.splice(c,1),a((function(e){return Object(S.a)(Object(S.a)({},e),{},Object(C.a)({},t,i))}))}else a((function(n){return Object(S.a)(Object(S.a)({},n),{},Object(C.a)({},t,[e]))}))}};return Object(Te.jsx)(Y.a,{open:e.open,onClose:function(){return e.so(!1)},TransitionComponent:Ut,fullScreen:!0,PaperProps:{elevation:8},children:Object(Te.jsxs)(Qe.a,{sx:{display:"flex"},children:[Object(Te.jsx)(k.a,{}),Object(Te.jsx)(I.a,{position:"fixed",sx:{zIndex:function(e){return e.zIndex.drawer+1}},children:Object(Te.jsxs)(E.a,{children:[Object(Te.jsx)(F.a,{edge:"start",color:"inherit",onClick:function(){return e.so(!1)},"aria-label":"close",children:Object(Te.jsx)(At.a,{})}),Object(Te.jsxs)(R.a,{sx:{ml:2,flex:1},variant:"h6",noWrap:!0,component:"div",children:["Chat Settings for ",i.name]})]})}),Object(Te.jsxs)(wt.a,{sx:{width:240,flexShrink:0,"& .MuiDrawer-paper":{width:240,boxSizing:"border-box"}},PaperProps:{elevation:4},variant:"permanent",anchor:"left",children:[Object(Te.jsx)(E.a,{}),Object(Te.jsx)(ke.a,{children:s.map((function(e,t){return Object(Te.jsxs)(B.b,{button:!0,onClick:function(){return b(t)},selected:d===t,children:[Object(Te.jsx)(J.a,{children:e.icon}),Object(Te.jsx)(M.a,{primary:e.title})]},e.title)}))})]}),Object(Te.jsxs)(Qe.a,{component:"main",sx:{flexGrow:1,p:3},children:[Object(Te.jsx)(E.a,{}),0===d&&Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(R.a,{variant:"h4",children:"Overview"}),Object(Te.jsxs)(Qe.a,{sx:{display:"flex",alignItems:"center",my:2},children:[Object(Te.jsxs)(Qe.a,{sx:{mr:2,position:"relative"},children:[Object(Te.jsxs)(Qe.a,{sx:{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",background:"#00000066",opacity:0,top:0,left:0,right:0,bottom:0,zIndex:2,transition:function(e){return e.transitions.create(["opacity"])},backdropFilter:"blur(6px)",padding:"15%",borderRadius:"50%",flexDirection:"column","&:hover":{opacity:1}},children:[Object(Te.jsx)(R.a,{align:"center",mb:1,variant:"button",fontWeight:700,children:"Change Icon"}),Object(Te.jsx)(Z.a,{startIcon:Object(Te.jsx)(Ft.a,{}),variant:"outlined",children:"Upload"})]}),Object(Te.jsx)(L.a,{sx:{width:150,height:150}})]}),Object(Te.jsx)(N.a,{orientation:"vertical",flexItem:!0,sx:{mr:2}}),Object(Te.jsxs)(Qe.a,{sx:{display:"flex",flexDirection:"column",flex:1},children:[Object(Te.jsx)(R.a,{variant:"h6",gutterBottom:!0,children:"Chat Info"}),Object(Te.jsx)(K.a,{variant:"filled",label:"Title",value:i.name}),Object(Te.jsx)(K.a,{variant:"outlined",label:"Description",multiline:!0,sx:{mt:2},maxRows:5})]})]}),Object(Te.jsx)(N.a,{}),Object(Te.jsxs)(ke.a,{children:[Object(Te.jsxs)(B.b,{children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(St.a,{})}),Object(Te.jsx)(M.a,{id:"sl-disc",primary:"Public Chat",secondary:"Allow random people to join your chat"}),Object(Te.jsx)(gt.a,{edge:"end",onChange:X("discovery",0),checked:(null!==(t=h[0])&&void 0!==t?t:[]).includes("discovery"),inputProps:{"aria-labelledby":"sl-disc"}})]}),Object(Te.jsxs)(B.b,{children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(St.a,{})}),Object(Te.jsx)(M.a,{id:"sl-disc",primary:"Public Chat",secondary:"Allow random people to join your chat"}),Object(Te.jsx)(gt.a,{edge:"end",onChange:X("discovery",0),checked:(null!==(n=h[0])&&void 0!==n?n:[]).includes("discovery"),inputProps:{"aria-labelledby":"sl-disc"}})]})]})]}),1===d&&Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(R.a,{variant:"h4",gutterBottom:!0,children:"Security"}),Object(Te.jsx)(R.a,{variant:"subtitle1",gutterBottom:!0,children:"Change various security settings of your chat"}),Object(Te.jsx)(N.a,{}),Object(Te.jsxs)(ke.a,{children:[Object(Te.jsxs)(B.b,{children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(ae.a,{})}),Object(Te.jsx)(M.a,{id:"e2ee-disc",primary:"Encrypted Chat",secondary:"Enables end to end encryption (cannot be undone)"}),Object(Te.jsx)(gt.a,{edge:"end",onChange:X("e2ee",1),checked:(null!==(a=h[1])&&void 0!==a?a:[]).includes("e2ee"),inputProps:{"aria-labelledby":"e2ee-disc"}})]}),Object(Te.jsxs)(B.b,{children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(St.a,{})}),Object(Te.jsx)(M.a,{id:"lol-disc",primary:"Lol no",secondary:"Hey"}),Object(Te.jsx)(gt.a,{edge:"end",onChange:X("hm",1),checked:(null!==(c=h[1])&&void 0!==c?c:[]).includes("hm"),inputProps:{"aria-labelledby":"lol-disc"}})]})]})]}),2===d&&Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(R.a,{variant:"h4",gutterBottom:!0,children:"Roles"}),Object(Te.jsx)(R.a,{variant:"subtitle1",gutterBottom:!0,children:"Edit and create user roles to manage permissions of"}),Object(Te.jsx)(N.a,{}),Object(Te.jsxs)(Qe.a,{sx:{display:"flex",alignItems:"flex-start",mt:2},children:[Object(Te.jsx)(yt.a,{sx:{width:240,mr:1,overflow:"hidden"},children:Object(Te.jsx)(ke.a,{sx:{p:0},children:w.map((function(e,t){return Object(Te.jsxs)(B.b,{button:!0,onClick:function(){return U(t)},selected:D===t,children:[Object(Te.jsx)(z.a,{children:Object(Te.jsx)(L.a,{sx:{background:e.color,width:36,height:36},children:e.name.slice(0,1)})}),Object(Te.jsx)(M.a,{primary:e.name,primaryTypographyProps:{noWrap:!0}})]},e.name)}))})}),Object(Te.jsxs)(yt.a,{sx:{ml:1,flex:1,px:1,pt:1},children:[Object(Te.jsxs)(R.a,{variant:"button",fontWeight:700,m:1,component:"h6",children:["Edit Role: ",w[D].name]}),Object(Te.jsxs)(Qe.a,{sx:{width:"100%",typography:"body1"},children:[Object(Te.jsx)(Qe.a,{sx:{borderBottom:1,borderColor:"divider"},children:Object(Te.jsxs)(vt.a,{onChange:function(e,t){return q(t)},value:H,children:[Object(Te.jsx)(kt.a,{label:"Appearance",value:"appear"}),Object(Te.jsx)(kt.a,{label:"Permissions",value:"perms"}),Object(Te.jsx)(kt.a,{label:"Manage Users",value:"usrMgmt"})]})}),Object(Te.jsxs)(Nt,{index:"appear",value:H,children:[Object(Te.jsx)(R.a,{gutterBottom:!0,children:"Name"}),Object(Te.jsx)(K.a,{variant:"filled",label:"Role Name",sx:{mb:2},value:w[D].name,fullWidth:!0}),Object(Te.jsx)(N.a,{sx:{mb:2}}),Object(Te.jsx)(R.a,{gutterBottom:!0,children:"Display Color"}),Object(Te.jsx)(Qe.a,{})]}),Object(Te.jsxs)(Nt,{index:"perms",value:H,children:[Object(Te.jsx)(K.a,{variant:"outlined",label:"Search permissions",fullWidth:!0,size:"small",sx:{my:.5}}),Object(Te.jsx)(ke.a,{sx:{pb:0},children:[{title:"General Permissions"},{title:"Manage Roles",desc:"Edit and create roles (what you're doing now)",key:1},{title:"Member Permissions"},{title:"Create Invite",desc:"Create a chat invite for others to join the chat",key:2},{title:"Kick Members",desc:"Remove members from the chat",key:3},{title:"Ban Members",desc:"Permanently block a member from the chat",key:4},{title:"Text Permissions"},{title:"Send Messages",desc:"Send text messages in the chat",key:5},{title:"Attach Files",desc:"Send messages with attachments (i.e. images, videos etc.)",key:6},{title:"Delete Messages",desc:"Allows members to delete their own messages",key:7},{title:"Manage Messages",desc:"Allows members to delete other's messages and pin messages",key:8},{title:"Advanced Permissions"},{title:"Administrator",desc:"Grant user all permissions",key:0}].map((function(e){var t,n,r,a=(null!==(t=e.key)&&void 0!==t?t:e.title.replace(" ","")).toString();return Object(Te.jsxs)(B.b,{sx:e.desc?{}:{py:0},disableGutters:!0,children:[Object(Te.jsx)(M.a,{id:a+"-disc",secondaryTypographyProps:e.desc?{}:{variant:"button",fontWeight:700,fontSize:13},primary:e.desc?e.title:"",secondary:null!==(n=e.desc)&&void 0!==n?n:e.title}),e.desc&&Object(Te.jsx)(gt.a,{edge:"end",onChange:X(a,D,!0),checked:(null!==(r=f[D])&&void 0!==r?r:[]).includes(a),inputProps:{"aria-labelledby":a+"-disc"}})]},a)}))})]}),Object(Te.jsxs)(Nt,{index:"usrMgmt",value:H,children:[Object(Te.jsx)(R.a,{children:"People who have this row:"}),Object(Te.jsxs)(ke.a,{sx:{pb:0},children:[Object(Te.jsxs)(B.b,{disableGutters:!0,children:[Object(Te.jsx)(M.a,{children:"A person"}),Object(Te.jsx)(V.a,{children:Object(Te.jsx)(F.a,{children:Object(Te.jsx)(Kt.a,{})})})]}),Object(Te.jsxs)(B.b,{disableGutters:!0,children:[Object(Te.jsx)(M.a,{children:"Another person"}),Object(Te.jsx)(V.a,{children:Object(Te.jsx)(F.a,{children:Object(Te.jsx)(Kt.a,{})})})]})]})]})]})]})]})]})]})]})})}var Jt=Object(T.a)((function(e){return{container:{minHeight:"calc(100vh - 64px)",display:"flex",alignItems:"stretch",padding:e.spacing(2)},code:{backgroundColor:e.palette.background.paper,border:"2px solid rgba(128, 128, 128, .5)",borderRadius:e.shape.borderRadius,padding:"".concat(e.spacing(.3)," ").concat(e.spacing(.5)),margin:"".concat(e.spacing(.5)," ").concat(e.spacing(.4)),display:"block",fontFamily:"Courier"}}})),Mt={},Vt="",Gt={};function Wt(e){var t,n=Jt(),a=e.ss,c=[{col:"#808080",label:"Connecting..."},{col:"#ff0000",label:"Error"},{col:"#00ff00",label:"Connected"},{col:"#ff8000",label:"Disconnected"}],i=Object(r.useState)(null),s=Object(u.a)(i,2),d=s[0],b=s[1],j=Object(r.useState)(null),x=Object(u.a)(j,2),h=x[0],p=x[1],O=Object(r.useState)(null),m=Object(u.a)(O,2),f=m[0],g=m[1],y=Object(r.useState)({}),v=Object(u.a)(y,2),w=v[0],k=v[1],T=Object(r.useState)({open:!1,msg:"",type:"success"}),te=Object(u.a)(T,2),re=te[0],ce=te[1],se=Object(r.useState)(0),le=Object(u.a)(se,2),de=le[0],je=le[1],he=Object(r.useState)(""),me=Object(u.a)(he,2),ge=me[0],ve=me[1],ke=Object(r.useState)([]),Ce=Object(u.a)(ke,2),Se=Ce[0],Pe=Ce[1],Ae=Object(r.useState)(!1),Ie=Object(u.a)(Ae,2),Re=Ie[0],Fe=Ie[1],Ke=Object(r.useState)(!1),Ue=Object(u.a)(Ke,2),Ne=Ue[0],Be=Ue[1],Je=Object(r.useState)(!1),Me=Object(u.a)(Je,2),Ve=Me[0],Ge=Me[1],We=Object(r.useState)(""),He=Object(u.a)(We,2),ze=He[0],Le=He[1],qe=Object(r.useState)({open:!1}),Xe=Object(u.a)(qe,2),_e=Xe[0],Qe=Xe[1],Ze=Object(r.useState)(""),$e=Object(u.a)(Ze,2),et=$e[0],tt=$e[1],nt=Object(r.useState)(0),rt=Object(u.a)(nt,2),at=rt[0],ct=rt[1],it=Object(r.useState)({name:"",gid:""}),st=Object(u.a)(it,2),ot=st[0],lt=st[1],ut=Object(r.useState)(!1),dt=Object(u.a)(ut,2),bt=dt[0],ht=dt[1],mt=Object(r.useState)({}),ft=Object(u.a)(mt,2),gt=ft[0],yt=ft[1],vt=Object(r.useRef)({}),wt=Object(r.useRef)({}),kt=Object(r.useRef)({}),Ct=Object(r.useRef)(),St=Object(r.useRef)(),Pt=Object(r.useRef)(null),At=Object(r.useRef)({}),Tt=Boolean(f),It=Boolean(h),Et=function(){var e=Object(r.useRef)(!0);return Object(r.useEffect)((function(){e.current=!1}),[]),e.current}(),Rt=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(Mt[d]=Se),a.setVal("chatData",JSON.stringify(Mt)).then()},Dt=function(){var e=Object(l.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Qe,e.t1=t,e.t2=n,e.next=5,xt(n);case 5:e.t3=e.sent,e.t4={uid:e.t1,key:e.t2,hash:e.t3,open:!0,mode:0},(0,e.t0)(e.t4);case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){Et||(console.log("here"),a.setVal("chats",JSON.stringify(w)).then())}),[w]),Object(r.useEffect)((function(){0!==Se.length&&0!==Object.keys(Mt).length&&Rt()}),[Se]),Object(r.useEffect)((function(){var e,t=null!==(e=Mt[d])&&void 0!==e?e:[];Pe((function(){return setTimeout((function(){var e;null===(e=St.current)||void 0===e||e.scrollToIndex({index:t.length,align:"bottom",behavior:"auto"}),console.log("scrolling",t.length)}),10),t}))}),[d]);var Ft=function(){var e=Object(l.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ct&&1===Ct.current.readyState){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,Ct.current.send(t);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Kt=function e(){Ct.current=null,Ct.current=new WebSocket("wss://api.chattyapp.cf");var t=null,n=+new Date,r=function(){var e=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ft(JSON.stringify({act:"ping"}));case 2:n=+new Date;case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Ct.current.onopen=Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(2!==de){e.next=2;break}return e.abrupt("return");case 2:return je(2),e.next=5,Ft(JSON.stringify({uid:Vt}));case 5:return e.next=7,Ft(JSON.stringify({act:"updatePub",key:wt.current.pub}));case 7:return e.next=9,Ft(JSON.stringify({act:"updateSign",key:kt.current.pubSign}));case 9:return e.next=11,r();case 11:t=setInterval(r,3e3);case 12:case"end":return e.stop()}}),e)}))),Ct.current.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(a){return}switch(console.log(t),t.resp){case"pong":ct(new Date-n);break;case"txtMsg":var r=function(){pt(t,wt,Gt).then((function(e){var n={msg:e,uid:t.uid},r=null;b((function(e){return r=e,e})),Mt[t.gid]||(Mt[t.gid]=[]),t.gid===r?Pe((function(e){return[].concat(Object(P.a)(e),[n])})):Mt[t.gid].push(n)}))};k((function(e){return e[t.gid]?(r(),e):(Ft(JSON.stringify({act:"getSignPub",target:t.uid})),At.current={uid:t.uid,act:r},Object(S.a)(Object(S.a)({},e),{},Object(C.a)({},t.gid,{name:"Unknown chat",people:[t.uid]})))}));break;case"pubKey":vt.current=Object(S.a)(Object(S.a)({},vt.current),{},Object(C.a)({},t.uid,t.pub)),Pt.current&&Pt.current.uid===t.uid&&Pt.current.act&&Pt.current.act(t.pub);break;case"signKey":if(Gt||(Gt={}),Gt[t.uid])return;Dt(t.uid,t.pub).then()}},Ct.current.onclose=function(){je(3),clearInterval(t),setTimeout(e,5e3)},Ct.current.onerror=function(){je(1)}};Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){var t,n,r,c,i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.getVal("pubKey");case 2:return t=e.sent,e.next=5,a.getVal("priKey");case 5:return n=e.sent,wt.current={pub:t,pri:n},e.next=9,a.getVal("signPub");case 9:return r=e.sent,e.next=12,a.getVal("signPri");case 12:return c=e.sent,kt.current={pubSign:r,priSign:c},console.log(kt.current),e.next=17,a.getVal("signKeys");case 17:return Gt=e.sent,console.log(Gt),e.next=21,a.getVal("uid");case 21:return Vt=e.sent,e.next=24,a.getVal("chats");case 24:return i=e.sent,k(i?JSON.parse(i):{}),e.next=28,a.getVal("chatData");case 28:s=e.sent,Mt=s?JSON.parse(s):{},Kt();case 31:case"end":return e.stop()}}),e)})))()}),[]);var Ut=function(){Fe(!1),lt({name:"",gid:""})},Nt=function(){return Be(!1)},Wt=function(){return p(null)},Ht=function(){return g(null)},zt=function(){return Ge(!1)};return Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsxs)("div",{style:{minHeight:"100vh"},children:[Object(Te.jsx)(I.a,{position:"relative",children:Object(Te.jsxs)(E.a,{children:[Object(Te.jsx)("img",{src:Oe,width:32,height:32,alt:""}),Object(Te.jsx)(R.a,{variant:"h6",component:"div",sx:{flexGrow:1,ml:2.5},children:"Chatty"}),Object(Te.jsxs)(D.a,{sx:{padding:"4px 12px",display:"flex",alignItems:"center"},elevation:4,children:[Object(Te.jsx)("div",{style:{width:10,height:10,borderRadius:"50%",marginRight:"8px",backgroundColor:c[de].col}}),Object(Te.jsxs)(R.a,{variant:"subtitle1",children:[c[de].label," \u2022 RT: ",at,"ms"]})]}),Object(Te.jsx)(F.a,{edge:"end",color:"inherit","aria-label":"lock",sx:{ml:1.5},onClick:function(){},children:Object(Te.jsx)(ae.a,{})})]})}),Object(Te.jsxs)("div",{className:n.container,children:[Object(Te.jsxs)(D.a,{sx:{width:400,mr:1,display:"grid",gridTemplateRows:"auto 1fr auto",maxHeight:"calc(100vh - 98px)"},elevation:6,children:[Object(Te.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%",padding:"10px"},children:[Object(Te.jsx)(K.a,{variant:"outlined",label:"Search",value:ge,onChange:function(e){return ve(e.target.value)},sx:{flexGrow:1,mr:1}}),Object(Te.jsx)(U.a,{color:"secondary","aria-label":"add",size:"medium",onClick:function(){return Fe(!0)},children:Object(Te.jsx)(ne.a,{})})]}),Object(Te.jsx)(De,{cl:w,sg:b,cg:d,q:ge,pk:Gt}),Object(Te.jsx)(N.a,{}),Object(Te.jsxs)(B.b,{button:!0,ContainerComponent:"div",id:"u-acc-btn",onClick:function(e){return g(e.currentTarget)},children:[Object(Te.jsx)(J.a,{children:Object(Te.jsx)(oe.a,{})}),Object(Te.jsx)(M.a,{primary:"Your Account"}),Object(Te.jsx)(V.a,{children:Object(Te.jsx)(G.a,{title:"Copy your UID",children:Object(Te.jsx)(F.a,{edge:"end","aria-label":"",sx:{mr:1e-4},onClick:function(){navigator.clipboard.writeText(Vt).then((function(){return ce({open:!0,msg:"Copied UID!",type:"success"})}))},children:Object(Te.jsx)(ue.a,{})})})})]}),Object(Te.jsxs)(W.a,{id:"u-acct-menu","aria-labelledby":"u-acc-btn",anchorEl:f,open:Tt,onClose:Ht,sx:{"& .MuiSvgIcon-root":{color:"text.secondary",marginRight:1.5}},PaperProps:{style:{minWidth:350}},anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"},children:[Object(Te.jsxs)(H.a,{onClick:Ht,children:[Object(Te.jsx)(ye.a,{})," Profile"]}),Object(Te.jsxs)(H.a,{onClick:Ht,children:[Object(Te.jsx)(we.a,{})," Account Settings"]}),Object(Te.jsxs)(H.a,{onClick:Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Qe,e.next=3,xt(kt.current.pubSign);case 3:e.t1=e.sent,e.t2={uid:null,key:null,hash:e.t1,open:!0,mode:1},(0,e.t0)(e.t2),Ht();case 7:case"end":return e.stop()}}),e)}))),children:[Object(Te.jsx)(fe.a,{})," Verify Sign Key"]})]})]}),Object(Te.jsx)(D.a,{sx:{flexGrow:1,ml:1,position:"relative",display:"flex",flexDirection:"column"},elevation:6,children:d?Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsxs)(B.b,{button:!0,divider:!0,ContainerComponent:"div",onClick:function(){yt({name:w[d].name}),ht(!0)},children:[Object(Te.jsx)(z.a,{children:Object(Te.jsx)(L.a,{children:Object(Te.jsx)(ie.a,{})})}),Object(Te.jsx)(M.a,{primary:w[d].name,secondary:w[d].people.join(", ")+" & You"}),Object(Te.jsxs)(V.a,{children:[Object(Te.jsx)(F.a,{edge:"end","aria-label":"",id:"more-btn","aria-controls":"more-menu",onClick:function(e){return p(e.currentTarget)},sx:{mr:1e-4},children:Object(Te.jsx)(be.a,{})}),Object(Te.jsxs)(W.a,{id:"more-menu",sx:{"& .MuiSvgIcon-root":{color:"text.secondary",marginRight:1.5}},MenuListProps:{"aria-labelledby":"more-btn"},anchorEl:h,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},open:It,onClose:Wt,children:[Object(Te.jsxs)(H.a,{onClick:function(){b((function(e){return tt(w[e].name),Ge(!0),Wt(),e}))},children:[Object(Te.jsx)(pe.a,{}),"Edit Chat Title"]}),Object(Te.jsxs)(H.a,{onClick:function(){Be(!0),Wt()},children:[Object(Te.jsx)(xe.a,{}),"Delete chat"]})]})]})]}),Object(Te.jsx)(jt,{c:Se,uid:Vt,r:St}),Object(Te.jsx)(Ye,{m:ze,sm:Le,send:function(){var e=ze.trim();0!==e.length&&(Pe([].concat(Object(P.a)(Se),[{msg:e,uid:Vt}])),Ot(d,w[d].people[0],ze,kt,vt,Pt,Ft).then((function(){Le("")})))}})]}):Object(Te.jsx)(Ee,{})})]})]}),Object(Te.jsxs)(Y.a,{maxWidth:"xs",open:Re,onClose:Ut,"aria-labelledby":"ac-d-t","aria-describedby":"ac-d-d",children:[Object(Te.jsx)(q.a,{id:"ac-d-t",children:"Add/Join a Chat"}),Object(Te.jsxs)(X.a,{children:[Object(Te.jsx)(_.a,{id:"ac-d-d",children:"Enter your recipient's UID here. This identifier does not need to be kept private."}),Object(Te.jsx)(K.a,{variant:"filled",sx:{width:"100%"},label:"Name",value:ot.name,onChange:function(e){return lt(Object(S.a)(Object(S.a)({},ot),{},{name:e.target.value}))}}),Object(Te.jsx)(K.a,{sx:{width:"100%",mt:2,"&>div":{fontFamily:"Courier"}},label:"UID",variant:"outlined",onChange:function(e){return lt(Object(S.a)(Object(S.a)({},ot),{},{gid:e.target.value}))},value:ot.gid})]}),Object(Te.jsxs)(Q.a,{children:[Object(Te.jsx)(Z.a,{onClick:Ut,children:"Close"}),Object(Te.jsx)(Z.a,{onClick:function(){k(Object(S.a)(Object(S.a)({},w),{},Object(C.a)({},Object(A.a)(),{name:ot.name,people:[ot.gid]}))),Ft(JSON.stringify({act:"getSignPub",target:ot.gid})),Ut()},children:"Add"})]})]}),Object(Te.jsxs)(Y.a,{maxWidth:"xs",open:Ne,onClose:Nt,"aria-labelledby":"cd-d-t","aria-describedby":"cd-d-d",children:[Object(Te.jsx)(q.a,{id:"cd-d-t",children:"Delete chat?"}),Object(Te.jsx)(X.a,{children:Object(Te.jsx)(_.a,{mb:"0!important",children:"All messages will be deleted. This action cannot be undone."})}),Object(Te.jsxs)(Q.a,{children:[Object(Te.jsx)(Z.a,{onClick:Nt,children:"Cancel"}),Object(Te.jsx)("div",{style:{flexGrow:1}}),Object(Te.jsx)(Z.a,{onClick:function(){var e=d;b(null),k((function(t){var n=Object(S.a)({},t);return delete n[e],n})),Pe([]),requestAnimationFrame((function(){delete Mt[e],console.log(Mt),Rt(!0)})),Nt()},children:"Delete"})]})]}),Object(Te.jsxs)(Y.a,{maxWidth:"xs",open:Ve,onClose:zt,"aria-labelledby":"ct-d-t","aria-describedby":"ct-d-d",children:[Object(Te.jsx)(q.a,{id:"ct-d-t",children:"Edit Chat Title"}),Object(Te.jsxs)(X.a,{children:[Object(Te.jsx)(_.a,{children:"Enter a new title for this chat below. It does not need to be unique."}),Object(Te.jsx)(K.a,{variant:"filled",value:et,onChange:function(e){return tt(e.target.value)},label:"New Chat Title",sx:{width:"100%"}})]}),Object(Te.jsxs)(Q.a,{children:[Object(Te.jsx)(Z.a,{onClick:zt,children:"Cancel"}),Object(Te.jsx)(Z.a,{onClick:function(){k((function(e){var t=Object(S.a)({},e);return t[d].name=et,t})),zt()},children:"Change Title"})]})]}),Object(Te.jsxs)(Y.a,{open:_e.open,onClose:function(){return Qe({open:!1})},"aria-labelledby":"ct-d-t","aria-describedby":"ct-d-d",children:[Object(Te.jsxs)(q.a,{id:"ct-d-t",children:["Verify ",0===_e.mode?"New":"Your"," Public Key"]}),Object(Te.jsx)(X.a,{children:Object(Te.jsxs)(_.a,{align:"center",mb:"0!important",children:[0===_e.mode&&Object(Te.jsxs)(Te.Fragment,{children:["Received a new public signing key from ",Object(Te.jsx)("span",{className:n.code,children:_e.uid}),"Cross check the code below with this person to ensure this key is authentic. This ensures your messages can only be decrypted by your recipient."]}),1===_e.mode&&Object(Te.jsx)(Te.Fragment,{children:"Cross check the code below with the code your recipient received."}),Object(Te.jsx)("span",{className:n.code,style:{fontWeight:900},children:null===_e||void 0===_e||null===(t=_e.hash)||void 0===t?void 0:t.join(" ")}),Object(Te.jsxs)("small",{style:{display:"block",marginBottom:8},children:["Ask your recipient to click on [",0===_e.mode?"Your Account":"(Your icon in chat)"," > Verify Sign Key] to verify this key."]}),"You can delete signing keys at [Settings > Manage Signing Keys]"]})}),Object(Te.jsxs)(Q.a,{children:[Object(Te.jsx)(Z.a,{onClick:function(){return Qe({open:!1})},children:0===_e.mode?"Reject":"Close"}),Object(Te.jsx)("div",{style:{flexGrow:1}}),0===_e.mode&&Object(Te.jsx)(Z.a,{onClick:function(){Gt=Object(S.a)(Object(S.a)({},Gt),{},Object(C.a)({},_e.uid,_e.key)),a.setVal("signKeys",Gt).then(),Qe({open:!1}),At.current&&At.current.uid===_e.uid&&At.current.act&&At.current.act()},children:"Accept"})]})]}),Object(Te.jsx)(Bt,{open:bt,so:ht,d:gt}),Object(Te.jsx)($.a,{open:re.open,autoHideDuration:3e3,onClose:function(){return ce(Object(S.a)(Object(S.a)({},re),{},{open:!1}))},children:Object(Te.jsx)(ee.a,{onClose:function(){return ce(Object(S.a)(Object(S.a)({},re),{},{open:!1}))},elevation:6,variant:"filled",severity:re.type,sx:{width:"100%"},children:re.msg})})]})}var Ht=n(289),zt=n(131),Lt=n.n(zt),Yt=n(269),qt=n(255),Xt=n(268),_t=n(288),Qt=n(129),Zt=n.n(Qt),$t=Object(r.forwardRef)((function(e,t){var n=Object(r.useState)(!1),a=Object(u.a)(n,2),c=a[0],i=a[1];return Object(Te.jsxs)(Yt.a,{sx:Object(S.a)(Object(S.a)({},e.sx),{},{"&>div":{pb:0}}),variant:"filled",children:[Object(Te.jsx)(qt.a,{htmlFor:"pw",children:"Password"}),Object(Te.jsx)(Xt.a,{label:"Password",sx:{width:"100%",pb:1},variant:"filled",ref:t,value:e.pw,onChange:function(t){return e.spw(t.target.value)},id:"pw",type:c?"text":"password",endAdornment:Object(Te.jsx)(_t.a,{position:"end",children:Object(Te.jsx)(F.a,{"aria-label":"toggle password visibility",onClick:function(){return i(!c)},onMouseDown:function(e){return e.preventDefault()},edge:"end",children:c?Object(Te.jsx)(It.a,{}):Object(Te.jsx)(Zt.a,{})})}),autoComplete:"current-password"})]})})),en=n(130),tn=n.n(en);function nn(e){var t=Object(r.useState)(!1),n=Object(u.a)(t,2),a=n[0],c=n[1],i=Object(r.useState)(!1),s=Object(u.a)(i,2),o=s[0],l=s[1],d=Object(r.useState)(""),b=Object(u.a)(d,2),j=b[0],x=b[1],h=Object(r.useRef)();return Object(Te.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(Te.jsxs)(D.a,{elevation:12,sx:{padding:2,minWidth:300},children:[Object(Te.jsx)(R.a,{variant:"h3",mb:.5,children:"Login"}),Object(Te.jsx)(R.a,{gutterBottom:!0,children:"to Chatty"}),Object(Te.jsx)(tn.a,{duration:500,count:1,spy:a,children:Object(Te.jsx)($t,{pw:j,spw:x,sx:{width:"100%",mt:.5},ref:h})}),Object(Te.jsx)(Ht.a,{sx:{mb:1.5,visibility:o?"visible":"hidden"}}),Object(Te.jsx)(Z.a,{variant:"contained",sx:{width:"100%"},endIcon:Object(Te.jsx)(Lt.a,{}),disabled:o,onClick:function(){l(!0),e.ss.unlock(j).then((function(t){l(!1),t?e.sl(!0):(console.log(h.current),c((function(e){return!e})))}))},children:"Login"})]})})}var rn=n(290),an=n(132),cn=n.n(an),sn=n(133),on=n.n(sn),ln=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"RSA-OAEP",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-512"}},!0,["encrypt","decrypt"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{pub:n,pri:r});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),un=function(){var e=Object(l.a)(o.a.mark((function e(){var t,n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-521"},!0,["sign","verify"]);case 2:return t=e.sent,e.next=5,window.crypto.subtle.exportKey("jwk",t.publicKey);case 5:return n=e.sent,e.next=8,window.crypto.subtle.exportKey("jwk",t.privateKey);case 8:return r=e.sent,e.abrupt("return",{signPri:r,signPub:n});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();function dn(e){var t=e.ss,n=Object(r.useState)(null),a=Object(u.a)(n,2),c=a[0],i=a[1],s=Object(r.useState)({}),d=Object(u.a)(s,2),b=d[0],j=d[1],x=Object(r.useState)({}),h=Object(u.a)(x,2),p=h[0],O=h[1],m=Object(r.useState)(""),f=Object(u.a)(m,2),g=f[0],y=f[1],v=Object(r.useState)(!1),w=Object(u.a)(v,2),k=w[0],C=w[1];return Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i("Generating keypair"),e.t0=j,e.next=4,ln();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),i("Generating signing keys"),e.t2=O,e.next=10,un();case 10:e.t3=e.sent,(0,e.t2)(e.t3),i(null);case 13:case"end":return e.stop()}}),e)})))()}),[]),Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center"},children:Object(Te.jsxs)("div",{style:{display:"flex",alignItems:"center",flexDirection:"column"},children:[Object(Te.jsx)(R.a,{variant:"h3",gutterBottom:!0,children:"Welcome to Chatty"}),Object(Te.jsx)(Z.a,{size:"large",variant:"contained",endIcon:Object(Te.jsx)(cn.a,{}),onClick:function(){return C(!0)},children:"Get started"})]})}),Object(Te.jsx)("div",{style:{position:"fixed",bottom:0,right:0,padding:8,display:"flex",alignItems:"center"},children:c?Object(Te.jsxs)(Te.Fragment,{children:[Object(Te.jsx)(R.a,{variant:"subtitle1",color:"text.secondary",children:c}),Object(Te.jsx)(rn.a,{size:30,sx:{ml:1}})]}):Object(Te.jsx)(G.a,{title:"No tasks running",children:Object(Te.jsx)(on.a,{})})}),Object(Te.jsxs)(Y.a,{open:k,onClose:function(){return C(!1)},maxWidth:"xs",fullWidth:!0,"aria-labelledby":"ob-d-t",children:[Object(Te.jsx)(q.a,{id:"ob-d-t",children:"Setup"}),Object(Te.jsx)(X.a,{sx:{py:0},children:Object(Te.jsxs)("div",{children:[Object(Te.jsx)(R.a,{component:"span",color:"text.secondary",children:"Enter a password that will be used to encrypt local chat data"}),Object(Te.jsx)($t,{pw:g,spw:y,sx:{width:"100%",mt:1}}),Object(Te.jsx)(R.a,{variant:"subtitle2",component:"small",pt:.5,color:"text.secondary",children:"Please remember this password - It cannot be recovered if lost"})]})}),Object(Te.jsx)(Q.a,{children:Object(Te.jsx)(Z.a,{onClick:Object(l.a)(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(!1),i("Initialising datastore"),e.next=4,t.init(g);case 4:return i("Saving keypair"),e.next=7,t.setVal("priKey",b.pri);case 7:return e.next=9,t.setVal("pubKey",b.pub);case 9:return i("Saving signing keys"),e.next=12,t.setVal("signPub",p.signPub);case 12:return e.next=14,t.setVal("signPri",p.signPri);case 14:return i("Generating UID"),e.next=17,t.setVal("uid",Object(A.a)());case 17:i("Reloading..."),document.location.reload();case 19:case"end":return e.stop()}}),e)}))),variant:"contained",sx:{width:"100%"},children:"Done"})})]})]})}function bn(){return Object(Te.jsxs)("div",{style:{minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[Object(Te.jsx)(rn.a,{}),Object(Te.jsx)(R.a,{mt:1,children:"Loading"})]})}n(174),n(175);var jn=new v;var xn=function(){var e=Object(r.useState)(!1),t=Object(u.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!1),i=Object(u.a)(c,2),s=i[0],d=i[1],j=Object(r.useState)(!0),x=Object(u.a)(j,2),h=x[0],p=x[1];return Object(r.useEffect)((function(){Object(l.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.isInit();case 2:t=e.sent,d(t),p(!1);case 5:case"end":return e.stop()}}),e)})))()}),[s]),Object(Te.jsx)(Te.Fragment,{children:Object(Te.jsxs)(w.a,{theme:b("dark"),children:[Object(Te.jsx)(k.a,{}),h?Object(Te.jsx)(bn,{}):s?n?Object(Te.jsx)(Wt,{ss:jn}):Object(Te.jsx)(nn,{sl:a,ss:jn}):Object(Te.jsx)(dn,{ss:jn})]})})},hn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,292)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};i.a.render(Object(Te.jsx)(a.a.StrictMode,{children:Object(Te.jsx)(xn,{})}),document.getElementById("root")),hn()}},[[176,1,2]]]);